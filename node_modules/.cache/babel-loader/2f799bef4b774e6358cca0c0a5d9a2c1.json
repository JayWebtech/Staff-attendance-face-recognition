{"ast":null,"code":"const Webcam = require('../helper/webcam');\n\nimport { ref } from 'vue';\nimport { savedUsers } from './useState';\n\nconst faceapi = require('../helper/faceApi.min.js');\n\nimport { useAlert } from './useNotification';\nimport { useRouter } from 'vue-router';\nlet snappedFace = ref().value;\n\nfunction loadLabeledImages(router) {\n  if (savedUsers.length == 0) {\n    useAlert().openAlert('You have no registered users, navigating to register page');\n    Webcam.reset();\n    setTimeout(() => {\n      router.push('/register');\n    }, 3000);\n  } else {\n    return Promise.all(savedUsers.map(async label => {\n      const descriptions = [];\n\n      for (let i = 1; i <= 2; i++) {\n        const queryImage = new Image();\n        queryImage.src = label.img;\n        const detections = await faceapi.detectSingleFace(queryImage).withFaceLandmarks().withFaceDescriptor();\n        descriptions.push(detections.descriptor);\n      }\n\n      return new faceapi.LabeledFaceDescriptors(label.name, descriptions);\n    }));\n  }\n}\n\nconst scanImg = async router => {\n  const image = new Image();\n  image.src = snappedFace; // const image = snappedFace\n\n  const container = document.createElement('div');\n  container.style.position = 'relative';\n  document.body.append(container);\n  const labeledFaceDescriptors = await loadLabeledImages(router);\n  const faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors, 0.4);\n  const canvas = await faceapi.createCanvasFromMedia(image);\n  document.body.append(canvas);\n  const displaySize = {\n    width: 350,\n    height: 265\n  };\n  faceapi.matchDimensions(canvas, displaySize);\n  const detection = await faceapi.detectAllFaces(image).withFaceLandmarks().withFaceDescriptors();\n\n  if (detection.length < 1) {\n    location.reload();\n  } else {\n    const resizedDetections = faceapi.resizeResults(detection, displaySize);\n    const results = resizedDetections.map(d => faceMatcher.findBestMatch(d.descriptor));\n    results.forEach((result, i) => {\n      const box = resizedDetections[i].detection.box;\n      const drawBox = new faceapi.draw.DrawBox(box, {\n        label: result.toString()\n      });\n      drawBox.draw(canvas);\n      savedUsers.map(async (label, index) => {\n        if (label.name === result._label) {\n          savedUsers[index].date.push(`${new Date().toLocaleTimeString()} of ${new Date().toLocaleDateString()}`);\n          canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n          useAlert().openAlert(`Attendance has been taken for ${result._label}`);\n          router.push('/attendanceSheet');\n        }\n      });\n      canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n      useAlert().openAlert('Unknown User Found, go and register');\n    });\n  }\n};\n\nexport const SnapFace = () => {\n  const router = useRouter();\n  const video = document.querySelector('#video');\n  let recog;\n  video.addEventListener('play', () => {\n    const canvas = faceapi.createCanvasFromMedia(video);\n    document.body.append(canvas);\n    const displaySize = {\n      width: video.width,\n      height: video.height\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    recog = setInterval(async () => {\n      try {\n        const detections = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n        const resizedDetections = faceapi.resizeResults(detections, displaySize);\n        canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n        faceapi.draw.drawDetections(canvas, resizedDetections);\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);\n\n        if (resizedDetections) {\n          if (resizedDetections.detection.score.toFixed(2) > 0.7) {\n            await clearInterval(recog);\n            canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n            document.querySelector('#alert').style.color = 'green';\n            document.querySelector('#alert').innerHTML = 'Face found';\n            Webcam.snap(function (data_uri) {\n              snappedFace = data_uri;\n            });\n            await scanImg(router);\n          } else {\n            document.querySelector('#alert').style.color = 'red';\n            document.querySelector('#alert').innerHTML = 'Can\\'t find a Face, Please Adjust';\n          }\n        }\n      } catch (err) {\n        console.log('something went wrong ====', err);\n      }\n    }, 1000);\n  });\n};","map":{"version":3,"sources":["/Users/kromate/Desktop/faceReg/fas/src/composibles/useAttendance.js"],"names":["Webcam","require","ref","savedUsers","faceapi","useAlert","useRouter","snappedFace","value","loadLabeledImages","router","length","openAlert","reset","setTimeout","push","Promise","all","map","label","descriptions","i","queryImage","Image","src","img","detections","detectSingleFace","withFaceLandmarks","withFaceDescriptor","descriptor","LabeledFaceDescriptors","name","scanImg","image","container","document","createElement","style","position","body","append","labeledFaceDescriptors","faceMatcher","FaceMatcher","canvas","createCanvasFromMedia","displaySize","width","height","matchDimensions","detection","detectAllFaces","withFaceDescriptors","location","reload","resizedDetections","resizeResults","results","d","findBestMatch","forEach","result","box","drawBox","draw","DrawBox","toString","index","_label","date","Date","toLocaleTimeString","toLocaleDateString","getContext","clearRect","SnapFace","video","querySelector","recog","addEventListener","setInterval","TinyFaceDetectorOptions","withFaceExpressions","drawDetections","drawFaceLandmarks","score","toFixed","clearInterval","color","innerHTML","snap","data_uri","err","console","log"],"mappings":"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","sourcesContent":["const Webcam = require('../helper/webcam')\nimport { ref } from 'vue';\nimport { savedUsers } from './useState';\nconst faceapi = require('../helper/faceApi.min.js')\nimport { useAlert } from './useNotification';\nimport { useRouter } from 'vue-router';\n\nlet snappedFace = ref().value\n\n\nfunction loadLabeledImages(router) {\n\tif (savedUsers.length == 0) {\n\t\tuseAlert().openAlert('You have no registered users, navigating to register page')\n\t\tWebcam.reset()\n\t\tsetTimeout(() => {\n\t\t\trouter.push('/register')\n\t\t}, 3000)\n\t\n\t} else {\n\t\treturn Promise.all(\n\t\t\tsavedUsers.map(async (label) => {\n\t\t\t\tconst descriptions = []\n\t\t\t\tfor (let i = 1; i <= 2; i++) {\n\t\t\t\t\tconst queryImage = new Image()\n\t\t\t\t\tqueryImage.src = label.img\n\t\t\t\t\tconst detections = await faceapi.detectSingleFace(queryImage).withFaceLandmarks().withFaceDescriptor()\n\t\t\t\t\tdescriptions.push(detections.descriptor)\n\t\t\t\t}\n\t\t\t\treturn new faceapi.LabeledFaceDescriptors(label.name, descriptions)\n\t\t\t})\n\t\t)\n\t}\n\n}\n\nconst scanImg = async (router) => {\n\n\tconst image = new Image()\n\timage.src = snappedFace\n\t\n\t// const image = snappedFace\n\tconst container = document.createElement('div')\n\tcontainer.style.position = 'relative'\n\tdocument.body.append(container)\n\tconst labeledFaceDescriptors = await loadLabeledImages(router)\n\t\n\tconst faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors, 0.4)\n\n\tconst canvas = await faceapi.createCanvasFromMedia(image)\n\tdocument.body.append(canvas)\n\tconst displaySize = { width: 350, height: 265 }\n\t\n\tfaceapi.matchDimensions(canvas, displaySize)\n\tconst detection = await faceapi.detectAllFaces(image).withFaceLandmarks().withFaceDescriptors()\n\tif (detection.length < 1) {\n\t\tlocation.reload()\n\t} else { \n\t\tconst resizedDetections = faceapi.resizeResults(detection, displaySize)\n\t\tconst results = resizedDetections.map((d) => faceMatcher.findBestMatch(d.descriptor))\n\t\tresults.forEach((result, i) => {\n\t\t\tconst box = resizedDetections[i].detection.box\n\t\t\tconst drawBox = new faceapi.draw.DrawBox(box, { label: result.toString() })\n\t\t\tdrawBox.draw(canvas)\n\t\t\tsavedUsers.map(async (label, index) => { \n\t\t\t\tif (label.name === result._label) {\n\t\t\t\t\tsavedUsers[index].date.push(`${new Date().toLocaleTimeString()} of ${new Date().toLocaleDateString()}`)\n\t\t\t\t\tcanvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n\t\t\t\t\tuseAlert().openAlert(`Attendance has been taken for ${result._label}`)\n\t\t\t\t\trouter.push('/attendanceSheet')\n\t\t\t\t} \n\t\t\t})\n\t\t\tcanvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n\t\t\tuseAlert().openAlert('Unknown User Found, go and register')\n\t\t})\n\t}\n}\n\nexport const SnapFace = () => {\n\tconst router = useRouter()\n\tconst video = document.querySelector('#video')\n\tlet recog\n\tvideo.addEventListener('play', () => {\n\t\tconst canvas = faceapi.createCanvasFromMedia(video)\n\t\tdocument.body.append(canvas)\n\t\tconst displaySize = { width: video.width, height: video.height }\n\t\tfaceapi.matchDimensions(canvas, displaySize)\n\t\trecog = setInterval(async () => {\n\t\t\ttry {\n\t\t\t\tconst detections = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()\n\t\t\t\tconst resizedDetections = faceapi.resizeResults(detections, displaySize)\n\t\t\t\tcanvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n\t\t\t\tfaceapi.draw.drawDetections(canvas, resizedDetections)\n\t\t\t\tfaceapi.draw.drawFaceLandmarks(canvas, resizedDetections)\n\t\t\t\t\n\t\t\t\tif (resizedDetections) {\n\t\t\t\t\tif (resizedDetections.detection.score.toFixed(2) > 0.7) {\n\t\t\t\t\t\tawait clearInterval(recog)\n\t\t\t\t\t\tcanvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n\t\t\t\t\t\tdocument.querySelector('#alert').style.color = 'green';\n\t\t\t\t\t\tdocument.querySelector('#alert').innerHTML = 'Face found'\n\t\t\t\t\t\tWebcam.snap(function (data_uri) {\n\t\t\t\t\t\t\tsnappedFace = data_uri\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait scanImg(router)\n                    \n\t\t\t\t\t} else {\n\t\t\t\t\t\tdocument.querySelector('#alert').style.color= 'red';\n\t\t\t\t\t\tdocument.querySelector('#alert').innerHTML = 'Can\\'t find a Face, Please Adjust'\n\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\n\t\t\t} catch(err) {\n\t\t\t\tconsole.log('something went wrong ====', err )\n\t\t\t}\n\t\t}, 1000)\n\t});   \n}"]},"metadata":{},"sourceType":"module"}