{"ast":null,"code":"// WebcamJS v1.0.25\n// Webcam library for capturing JPEG/PNG images in JavaScript\n// Attempts get UserMedia,falls back to Flash       \n// Author: Joseph Huckaby: http://github.com/jhuckaby\n// Based on JPEGCam: http://code.google.com/p/jpegcam/\n// Copyright (c) 2012 - 2017 Joseph Huckaby\n// Licensed under the MIT License\n\n/* eslint-disable */\n(function (window) {\n  var _userMedia; // declare error types\n  // inheritance pattern here:\n  // https://stackoverflow.com/questions/783818/how-do-i-create-a-custom-error-in-javascript\n\n\n  function FlashError() {\n    var temp = Error.apply(this, arguments);\n    temp.name = this.name = \"FlashError\";\n    this.stack = temp.stack;\n    this.message = temp.message;\n  }\n\n  function WebcamError() {\n    var temp = Error.apply(this, arguments);\n    temp.name = this.name = \"WebcamError\";\n    this.stack = temp.stack;\n    this.message = temp.message;\n  }\n\n  var IntermediateInheritor = function () {};\n\n  IntermediateInheritor.prototype = Error.prototype;\n  FlashError.prototype = new IntermediateInheritor();\n  WebcamError.prototype = new IntermediateInheritor();\n  var Webcam = {\n    version: '1.0.25',\n    // globals\n    protocol: location.protocol.match(/https/i) ? 'https' : 'http',\n    loaded: false,\n    // true when webcam movie finishes loading\n    live: false,\n    // true when webcam is initialized and ready to snap\n    userMedia: true,\n    // true when getUserMedia is supported natively\n    iOS: /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,\n    params: {\n      width: 0,\n      height: 0,\n      dest_width: 0,\n      // size of captured image\n      dest_height: 0,\n      // these default to width/height\n      image_format: 'png',\n      // image format (may be jpeg or png)\n      jpeg_quality: 100,\n      // jpeg image quality from 0 (worst) to 100 (best)\n      enable_flash: true,\n      // enable flash fallback,\n      force_flash: false,\n      // force flash mode,\n      flip_horiz: false,\n      // flip image horiz (mirror mode)\n      fps: 30,\n      // camera frames per second\n      upload_name: 'webcam',\n      // name of file in upload post data\n      constraints: null,\n      // custom user media constraints,\n      swfURL: '',\n      // URI to webcam.swf movie (defaults to the js location)\n      flashNotDetectedText: 'ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).',\n      noInterfaceFoundText: 'No supported webcam interface found.',\n      unfreeze_snap: true,\n      // Whether to unfreeze the camera after snap (defaults to true)\n      iosPlaceholderText: 'Click here to open camera.',\n      user_callback: null,\n      // callback function for snapshot (used if no user_callback parameter given to snap function)\n      user_canvas: null // user provided canvas for snapshot (used if no user_canvas parameter given to snap function)\n\n    },\n    errors: {\n      FlashError: FlashError,\n      WebcamError: WebcamError\n    },\n    hooks: {},\n    // callback hook functions\n    init: function () {\n      // initialize, check for getUserMedia support\n      var self = this; // Setup getUserMedia, with polyfill for older browsers\n      // Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n\n      this.mediaDevices = navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? navigator.mediaDevices : navigator.mozGetUserMedia || navigator.webkitGetUserMedia ? {\n        getUserMedia: function (c) {\n          return new Promise(function (y, n) {\n            (navigator.mozGetUserMedia || navigator.webkitGetUserMedia).call(navigator, c, y, n);\n          });\n        }\n      } : null;\n      window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n      this.userMedia = this.userMedia && !!this.mediaDevices && !!window.URL;\n\n      if (this.iOS) {\n        this.userMedia = null;\n      } // Older versions of firefox (< 21) apparently claim support but user media does not actually work\n\n\n      if (navigator.userAgent.match(/Firefox\\D+(\\d+)/)) {\n        if (parseInt(RegExp.$1, 10) < 21) this.userMedia = null;\n      } // Make sure media stream is closed when navigating away from page\n\n\n      if (this.userMedia) {\n        window.addEventListener('beforeunload', function (event) {\n          self.reset();\n        });\n      }\n    },\n    exifOrientation: function (binFile) {\n      // extract orientation information from the image provided by iOS\n      // algorithm based on exif-js\n      var dataView = new DataView(binFile);\n\n      if (dataView.getUint8(0) != 0xFF || dataView.getUint8(1) != 0xD8) {\n        console.log('Not a valid JPEG file');\n        return 0;\n      }\n\n      var offset = 2;\n      var marker = null;\n\n      while (offset < binFile.byteLength) {\n        // find 0xFFE1 (225 marker)\n        if (dataView.getUint8(offset) != 0xFF) {\n          console.log('Not a valid marker at offset ' + offset + ', found: ' + dataView.getUint8(offset));\n          return 0;\n        }\n\n        marker = dataView.getUint8(offset + 1);\n\n        if (marker == 225) {\n          offset += 4;\n          var str = \"\";\n\n          for (n = 0; n < 4; n++) {\n            str += String.fromCharCode(dataView.getUint8(offset + n));\n          }\n\n          if (str != 'Exif') {\n            console.log('Not valid EXIF data found');\n            return 0;\n          }\n\n          offset += 6; // tiffOffset\n\n          var bigEnd = null; // test for TIFF validity and endianness\n\n          if (dataView.getUint16(offset) == 0x4949) {\n            bigEnd = false;\n          } else if (dataView.getUint16(offset) == 0x4D4D) {\n            bigEnd = true;\n          } else {\n            console.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\n            return 0;\n          }\n\n          if (dataView.getUint16(offset + 2, !bigEnd) != 0x002A) {\n            console.log(\"Not valid TIFF data! (no 0x002A)\");\n            return 0;\n          }\n\n          var firstIFDOffset = dataView.getUint32(offset + 4, !bigEnd);\n\n          if (firstIFDOffset < 0x00000008) {\n            console.log(\"Not valid TIFF data! (First offset less than 8)\", dataView.getUint32(offset + 4, !bigEnd));\n            return 0;\n          } // extract orientation data\n\n\n          var dataStart = offset + firstIFDOffset;\n          var entries = dataView.getUint16(dataStart, !bigEnd);\n\n          for (var i = 0; i < entries; i++) {\n            var entryOffset = dataStart + i * 12 + 2;\n\n            if (dataView.getUint16(entryOffset, !bigEnd) == 0x0112) {\n              var valueType = dataView.getUint16(entryOffset + 2, !bigEnd);\n              var numValues = dataView.getUint32(entryOffset + 4, !bigEnd);\n\n              if (valueType != 3 && numValues != 1) {\n                console.log('Invalid EXIF orientation value type (' + valueType + ') or count (' + numValues + ')');\n                return 0;\n              }\n\n              var value = dataView.getUint16(entryOffset + 8, !bigEnd);\n\n              if (value < 1 || value > 8) {\n                console.log('Invalid EXIF orientation value (' + value + ')');\n                return 0;\n              }\n\n              return value;\n            }\n          }\n        } else {\n          offset += 2 + dataView.getUint16(offset + 2);\n        }\n      }\n\n      return 0;\n    },\n    fixOrientation: function (origObjURL, orientation, targetImg) {\n      // fix image orientation based on exif orientation data\n      // exif orientation information\n      //    http://www.impulseadventure.com/photo/exif-orientation.html\n      //    link source wikipedia (https://en.wikipedia.org/wiki/Exif#cite_note-20)\n      var img = new Image();\n      img.addEventListener('load', function (event) {\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d'); // switch width height if orientation needed\n\n        if (orientation < 5) {\n          canvas.width = img.width;\n          canvas.height = img.height;\n        } else {\n          canvas.width = img.height;\n          canvas.height = img.width;\n        } // transform (rotate) image - see link at beginning this method\n\n\n        switch (orientation) {\n          case 2:\n            ctx.transform(-1, 0, 0, 1, img.width, 0);\n            break;\n\n          case 3:\n            ctx.transform(-1, 0, 0, -1, img.width, img.height);\n            break;\n\n          case 4:\n            ctx.transform(1, 0, 0, -1, 0, img.height);\n            break;\n\n          case 5:\n            ctx.transform(0, 1, 1, 0, 0, 0);\n            break;\n\n          case 6:\n            ctx.transform(0, 1, -1, 0, img.height, 0);\n            break;\n\n          case 7:\n            ctx.transform(0, -1, -1, 0, img.height, img.width);\n            break;\n\n          case 8:\n            ctx.transform(0, -1, 1, 0, 0, img.width);\n            break;\n        }\n\n        ctx.drawImage(img, 0, 0); // pass rotated image data to the target image container\n\n        targetImg.src = canvas.toDataURL();\n      }, false); // start transformation by load event\n\n      img.src = origObjURL;\n    },\n    attach: function (elem) {\n      // create webcam preview and attach to DOM element\n      // pass in actual DOM reference, ID, or CSS selector\n      if (typeof elem == 'string') {\n        elem = document.getElementById(elem) || document.querySelector(elem);\n      }\n\n      if (!elem) {\n        return this.dispatch('error', new WebcamError(\"Could not locate DOM element to attach to.\"));\n      }\n\n      this.container = elem;\n      elem.innerHTML = ''; // start with empty element\n      // insert \"peg\" so we can insert our preview canvas adjacent to it later on\n\n      var peg = document.createElement('div');\n      elem.appendChild(peg);\n      this.peg = peg; // set width/height if not already set\n\n      if (!this.params.width) this.params.width = elem.offsetWidth;\n      if (!this.params.height) this.params.height = elem.offsetHeight; // make sure we have a nonzero width and height at this point\n\n      if (!this.params.width || !this.params.height) {\n        return this.dispatch('error', new WebcamError(\"No width and/or height for webcam.  Please call set() first, or attach to a visible element.\"));\n      } // set defaults for dest_width / dest_height if not set\n\n\n      if (!this.params.dest_width) this.params.dest_width = this.params.width;\n      if (!this.params.dest_height) this.params.dest_height = this.params.height;\n      this.userMedia = _userMedia === undefined ? this.userMedia : _userMedia; // if force_flash is set, disable userMedia\n\n      if (this.params.force_flash) {\n        _userMedia = this.userMedia;\n        this.userMedia = null;\n      } // check for default fps\n\n\n      if (typeof this.params.fps !== \"number\") this.params.fps = 30; // adjust scale if dest_width or dest_height is different\n\n      var scaleX = this.params.width / this.params.dest_width;\n      var scaleY = this.params.height / this.params.dest_height;\n\n      if (this.userMedia) {\n        // setup webcam video container\n        var video = document.createElement('video');\n        video.setAttribute('autoplay', 'autoplay');\n        video.style.width = '' + this.params.dest_width + 'px';\n        video.style.height = '' + this.params.dest_height + 'px';\n\n        if (scaleX != 1.0 || scaleY != 1.0) {\n          elem.style.overflow = 'hidden';\n          video.style.webkitTransformOrigin = '0px 0px';\n          video.style.mozTransformOrigin = '0px 0px';\n          video.style.msTransformOrigin = '0px 0px';\n          video.style.oTransformOrigin = '0px 0px';\n          video.style.transformOrigin = '0px 0px';\n          video.style.webkitTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.mozTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.msTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.oTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.transform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        } // add video element to dom\n\n\n        elem.appendChild(video);\n        this.video = video; // ask user for access to their camera\n\n        var self = this;\n        this.mediaDevices.getUserMedia({\n          \"audio\": false,\n          \"video\": this.params.constraints || {\n            mandatory: {\n              minWidth: this.params.dest_width,\n              minHeight: this.params.dest_height\n            }\n          }\n        }).then(function (stream) {\n          // got access, attach stream to video\n          video.onloadedmetadata = function (e) {\n            self.stream = stream;\n            self.loaded = true;\n            self.live = true;\n            self.dispatch('load');\n            self.dispatch('live');\n            self.flip();\n          }; // as window.URL.createObjectURL() is deprecated, adding a check so that it works in Safari.\n          // older browsers may not have srcObject\n\n\n          if (\"srcObject\" in video) {\n            video.srcObject = stream;\n          } else {\n            // using URL.createObjectURL() as fallback for old browsers\n            video.src = window.URL.createObjectURL(stream);\n          }\n        }).catch(function (err) {\n          // JH 2016-07-31 Instead of dispatching error, now falling back to Flash if userMedia fails (thx @john2014)\n          // JH 2016-08-07 But only if flash is actually installed -- if not, dispatch error here and now.\n          if (self.params.enable_flash && self.detectFlash()) {\n            setTimeout(function () {\n              self.params.force_flash = 1;\n              self.attach(elem);\n            }, 1);\n          } else {\n            self.dispatch('error', err);\n          }\n        });\n      } else if (this.iOS) {\n        // prepare HTML elements\n        var div = document.createElement('div');\n        div.id = this.container.id + '-ios_div';\n        div.className = 'webcamjs-ios-placeholder';\n        div.style.width = '' + this.params.width + 'px';\n        div.style.height = '' + this.params.height + 'px';\n        div.style.textAlign = 'center';\n        div.style.display = 'table-cell';\n        div.style.verticalAlign = 'middle';\n        div.style.backgroundRepeat = 'no-repeat';\n        div.style.backgroundSize = 'contain';\n        div.style.backgroundPosition = 'center';\n        var span = document.createElement('span');\n        span.className = 'webcamjs-ios-text';\n        span.innerHTML = this.params.iosPlaceholderText;\n        div.appendChild(span);\n        var img = document.createElement('img');\n        img.id = this.container.id + '-ios_img';\n        img.style.width = '' + this.params.dest_width + 'px';\n        img.style.height = '' + this.params.dest_height + 'px';\n        img.style.display = 'none';\n        div.appendChild(img);\n        var input = document.createElement('input');\n        input.id = this.container.id + '-ios_input';\n        input.setAttribute('type', 'file');\n        input.setAttribute('accept', 'image/*');\n        input.setAttribute('capture', 'camera');\n        var self = this;\n        var params = this.params; // add input listener to load the selected image\n\n        input.addEventListener('change', function (event) {\n          if (event.target.files.length > 0 && event.target.files[0].type.indexOf('image/') == 0) {\n            var objURL = URL.createObjectURL(event.target.files[0]); // load image with auto scale and crop\n\n            var image = new Image();\n            image.addEventListener('load', function (event) {\n              var canvas = document.createElement('canvas');\n              canvas.width = params.dest_width;\n              canvas.height = params.dest_height;\n              var ctx = canvas.getContext('2d'); // crop and scale image for final size\n\n              ratio = Math.min(image.width / params.dest_width, image.height / params.dest_height);\n              var sw = params.dest_width * ratio;\n              var sh = params.dest_height * ratio;\n              var sx = (image.width - sw) / 2;\n              var sy = (image.height - sh) / 2;\n              ctx.drawImage(image, sx, sy, sw, sh, 0, 0, params.dest_width, params.dest_height);\n              var dataURL = canvas.toDataURL();\n              img.src = dataURL;\n              div.style.backgroundImage = \"url('\" + dataURL + \"')\";\n            }, false); // read EXIF data\n\n            var fileReader = new FileReader();\n            fileReader.addEventListener('load', function (e) {\n              var orientation = self.exifOrientation(e.target.result);\n\n              if (orientation > 1) {\n                // image need to rotate (see comments on fixOrientation method for more information)\n                // transform image and load to image object\n                self.fixOrientation(objURL, orientation, image);\n              } else {\n                // load image data to image object\n                image.src = objURL;\n              }\n            }, false); // Convert image data to blob format\n\n            var http = new XMLHttpRequest();\n            http.open(\"GET\", objURL, true);\n            http.responseType = \"blob\";\n\n            http.onload = function (e) {\n              if (this.status == 200 || this.status === 0) {\n                fileReader.readAsArrayBuffer(this.response);\n              }\n            };\n\n            http.send();\n          }\n        }, false);\n        input.style.display = 'none';\n        elem.appendChild(input); // make div clickable for open camera interface\n\n        div.addEventListener('click', function (event) {\n          if (params.user_callback) {\n            // global user_callback defined - create the snapshot\n            self.snap(params.user_callback, params.user_canvas);\n          } else {\n            // no global callback definied for snapshot, load image and wait for external snap method call\n            input.style.display = 'block';\n            input.focus();\n            input.click();\n            input.style.display = 'none';\n          }\n        }, false);\n        elem.appendChild(div);\n        this.loaded = true;\n        this.live = true;\n      } else if (this.params.enable_flash && this.detectFlash()) {\n        // flash fallback\n        window.Webcam = Webcam; // needed for flash-to-js interface\n\n        var div = document.createElement('div');\n        div.innerHTML = this.getSWFHTML();\n        elem.appendChild(div);\n      } else {\n        this.dispatch('error', new WebcamError(this.params.noInterfaceFoundText));\n      } // setup final crop for live preview\n\n\n      if (this.params.crop_width && this.params.crop_height) {\n        var scaled_crop_width = Math.floor(this.params.crop_width * scaleX);\n        var scaled_crop_height = Math.floor(this.params.crop_height * scaleY);\n        elem.style.width = '' + scaled_crop_width + 'px';\n        elem.style.height = '' + scaled_crop_height + 'px';\n        elem.style.overflow = 'hidden';\n        elem.scrollLeft = Math.floor(this.params.width / 2 - scaled_crop_width / 2);\n        elem.scrollTop = Math.floor(this.params.height / 2 - scaled_crop_height / 2);\n      } else {\n        // no crop, set size to desired\n        elem.style.width = '' + this.params.width + 'px';\n        elem.style.height = '' + this.params.height + 'px';\n      }\n    },\n    reset: function () {\n      // shutdown camera, reset to potentially attach again\n      if (this.preview_active) this.unfreeze(); // attempt to fix issue #64\n\n      this.unflip();\n\n      if (this.userMedia) {\n        if (this.stream) {\n          if (this.stream.getVideoTracks) {\n            // get video track to call stop on it\n            var tracks = this.stream.getVideoTracks();\n            if (tracks && tracks[0] && tracks[0].stop) tracks[0].stop();\n          } else if (this.stream.stop) {\n            // deprecated, may be removed in future\n            this.stream.stop();\n          }\n        }\n\n        delete this.stream;\n        delete this.video;\n      }\n\n      if (this.userMedia !== true && this.loaded && !this.iOS) {\n        // call for turn off camera in flash\n        var movie = this.getMovie();\n        if (movie && movie._releaseCamera) movie._releaseCamera();\n      }\n\n      if (this.container) {\n        this.container.innerHTML = '';\n        delete this.container;\n      }\n\n      this.loaded = false;\n      this.live = false;\n    },\n    set: function () {\n      // set one or more params\n      // variable argument list: 1 param = hash, 2 params = key, value\n      if (arguments.length == 1) {\n        for (var key in arguments[0]) {\n          this.params[key] = arguments[0][key];\n        }\n      } else {\n        this.params[arguments[0]] = arguments[1];\n      }\n    },\n    on: function (name, callback) {\n      // set callback hook\n      name = name.replace(/^on/i, '').toLowerCase();\n      if (!this.hooks[name]) this.hooks[name] = [];\n      this.hooks[name].push(callback);\n    },\n    off: function (name, callback) {\n      // remove callback hook\n      name = name.replace(/^on/i, '').toLowerCase();\n\n      if (this.hooks[name]) {\n        if (callback) {\n          // remove one selected callback from list\n          var idx = this.hooks[name].indexOf(callback);\n          if (idx > -1) this.hooks[name].splice(idx, 1);\n        } else {\n          // no callback specified, so clear all\n          this.hooks[name] = [];\n        }\n      }\n    },\n    dispatch: function () {\n      // fire hook callback, passing optional value to it\n      var name = arguments[0].replace(/^on/i, '').toLowerCase();\n      var args = Array.prototype.slice.call(arguments, 1);\n\n      if (this.hooks[name] && this.hooks[name].length) {\n        for (var idx = 0, len = this.hooks[name].length; idx < len; idx++) {\n          var hook = this.hooks[name][idx];\n\n          if (typeof hook == 'function') {\n            // callback is function reference, call directly\n            hook.apply(this, args);\n          } else if (typeof hook == 'object' && hook.length == 2) {\n            // callback is PHP-style object instance method\n            hook[0][hook[1]].apply(hook[0], args);\n          } else if (window[hook]) {\n            // callback is global function name\n            window[hook].apply(window, args);\n          }\n        } // loop\n\n\n        return true;\n      } else if (name == 'error') {\n        var message;\n\n        if (args[0] instanceof FlashError || args[0] instanceof WebcamError) {\n          message = args[0].message;\n        } else {\n          message = \"Could not access webcam: \" + args[0].name + \": \" + args[0].message + \" \" + args[0].toString();\n        } // default error handler if no custom one specified\n\n\n        alert(\"Webcam.js Error: \" + message);\n      }\n\n      return false; // no hook defined\n    },\n    setSWFLocation: function (value) {\n      // for backward compatibility.\n      this.set('swfURL', value);\n    },\n    detectFlash: function () {\n      // return true if browser supports flash, false otherwise\n      // Code snippet borrowed from: https://github.com/swfobject/swfobject\n      var SHOCKWAVE_FLASH = \"Shockwave Flash\",\n          SHOCKWAVE_FLASH_AX = \"ShockwaveFlash.ShockwaveFlash\",\n          FLASH_MIME_TYPE = \"application/x-shockwave-flash\",\n          win = window,\n          nav = navigator,\n          hasFlash = false;\n\n      if (typeof nav.plugins !== \"undefined\" && typeof nav.plugins[SHOCKWAVE_FLASH] === \"object\") {\n        var desc = nav.plugins[SHOCKWAVE_FLASH].description;\n\n        if (desc && typeof nav.mimeTypes !== \"undefined\" && nav.mimeTypes[FLASH_MIME_TYPE] && nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin) {\n          hasFlash = true;\n        }\n      } else if (typeof win.ActiveXObject !== \"undefined\") {\n        try {\n          var ax = new ActiveXObject(SHOCKWAVE_FLASH_AX);\n\n          if (ax) {\n            var ver = ax.GetVariable(\"$version\");\n            if (ver) hasFlash = true;\n          }\n        } catch (e) {}\n      }\n\n      return hasFlash;\n    },\n    getSWFHTML: function () {\n      // Return HTML for embedding flash based webcam capture movie\t\t\n      var html = '',\n          swfURL = this.params.swfURL; // make sure we aren't running locally (flash doesn't work)\n\n      if (location.protocol.match(/file/)) {\n        this.dispatch('error', new FlashError(\"Flash does not work from local disk.  Please run from a web server.\"));\n        return '<h3 style=\"color:red\">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';\n      } // make sure we have flash\n\n\n      if (!this.detectFlash()) {\n        this.dispatch('error', new FlashError(\"Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.\"));\n        return '<h3 style=\"color:red\">' + this.params.flashNotDetectedText + '</h3>';\n      } // set default swfURL if not explicitly set\n\n\n      if (!swfURL) {\n        // find our script tag, and use that base URL\n        var base_url = '';\n        var scpts = document.getElementsByTagName('script');\n\n        for (var idx = 0, len = scpts.length; idx < len; idx++) {\n          var src = scpts[idx].getAttribute('src');\n\n          if (src && src.match(/\\/webcam(\\.min)?\\.js/)) {\n            base_url = src.replace(/\\/webcam(\\.min)?\\.js.*$/, '');\n            idx = len;\n          }\n        }\n\n        if (base_url) swfURL = base_url + '/webcam.swf';else swfURL = 'webcam.swf';\n      } // if this is the user's first visit, set flashvar so flash privacy settings panel is shown first\n\n\n      if (window.localStorage && !localStorage.getItem('visited')) {\n        this.params.new_user = 1;\n        localStorage.setItem('visited', 1);\n      } // construct flashvars string\n\n\n      var flashvars = '';\n\n      for (var key in this.params) {\n        if (flashvars) flashvars += '&';\n        flashvars += key + '=' + escape(this.params[key]);\n      } // construct object/embed tag\n\n\n      html += '<object classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" type=\"application/x-shockwave-flash\" codebase=\"' + this.protocol + '://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0\" width=\"' + this.params.width + '\" height=\"' + this.params.height + '\" id=\"webcam_movie_obj\" align=\"middle\"><param name=\"wmode\" value=\"opaque\" /><param name=\"allowScriptAccess\" value=\"always\" /><param name=\"allowFullScreen\" value=\"false\" /><param name=\"movie\" value=\"' + swfURL + '\" /><param name=\"loop\" value=\"false\" /><param name=\"menu\" value=\"false\" /><param name=\"quality\" value=\"best\" /><param name=\"bgcolor\" value=\"#ffffff\" /><param name=\"flashvars\" value=\"' + flashvars + '\"/><embed id=\"webcam_movie_embed\" src=\"' + swfURL + '\" wmode=\"opaque\" loop=\"false\" menu=\"false\" quality=\"best\" bgcolor=\"#ffffff\" width=\"' + this.params.width + '\" height=\"' + this.params.height + '\" name=\"webcam_movie_embed\" align=\"middle\" allowScriptAccess=\"always\" allowFullScreen=\"false\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" flashvars=\"' + flashvars + '\"></embed></object>';\n      return html;\n    },\n    getMovie: function () {\n      // get reference to movie object/embed in DOM\n      if (!this.loaded) return this.dispatch('error', new FlashError(\"Flash Movie is not loaded yet\"));\n      var movie = document.getElementById('webcam_movie_obj');\n      if (!movie || !movie._snap) movie = document.getElementById('webcam_movie_embed');\n      if (!movie) this.dispatch('error', new FlashError(\"Cannot locate Flash movie in DOM\"));\n      return movie;\n    },\n    freeze: function () {\n      // show preview, freeze camera\n      var self = this;\n      var params = this.params; // kill preview if already active\n\n      if (this.preview_active) this.unfreeze(); // determine scale factor\n\n      var scaleX = this.params.width / this.params.dest_width;\n      var scaleY = this.params.height / this.params.dest_height; // must unflip container as preview canvas will be pre-flipped\n\n      this.unflip(); // calc final size of image\n\n      var final_width = params.crop_width || params.dest_width;\n      var final_height = params.crop_height || params.dest_height; // create canvas for holding preview\n\n      var preview_canvas = document.createElement('canvas');\n      preview_canvas.width = final_width;\n      preview_canvas.height = final_height;\n      var preview_context = preview_canvas.getContext('2d'); // save for later use\n\n      this.preview_canvas = preview_canvas;\n      this.preview_context = preview_context; // scale for preview size\n\n      if (scaleX != 1.0 || scaleY != 1.0) {\n        preview_canvas.style.webkitTransformOrigin = '0px 0px';\n        preview_canvas.style.mozTransformOrigin = '0px 0px';\n        preview_canvas.style.msTransformOrigin = '0px 0px';\n        preview_canvas.style.oTransformOrigin = '0px 0px';\n        preview_canvas.style.transformOrigin = '0px 0px';\n        preview_canvas.style.webkitTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.mozTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.msTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.oTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.transform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n      } // take snapshot, but fire our own callback\n\n\n      this.snap(function () {\n        // add preview image to dom, adjust for crop\n        preview_canvas.style.position = 'relative';\n        preview_canvas.style.left = '' + self.container.scrollLeft + 'px';\n        preview_canvas.style.top = '' + self.container.scrollTop + 'px';\n        self.container.insertBefore(preview_canvas, self.peg);\n        self.container.style.overflow = 'hidden'; // set flag for user capture (use preview)\n\n        self.preview_active = true;\n      }, preview_canvas);\n    },\n    unfreeze: function () {\n      // cancel preview and resume live video feed\n      if (this.preview_active) {\n        // remove preview canvas\n        this.container.removeChild(this.preview_canvas);\n        delete this.preview_context;\n        delete this.preview_canvas; // unflag\n\n        this.preview_active = false; // re-flip if we unflipped before\n\n        this.flip();\n      }\n    },\n    flip: function () {\n      // flip container horiz (mirror mode) if desired\n      if (this.params.flip_horiz) {\n        var sty = this.container.style;\n        sty.webkitTransform = 'scaleX(-1)';\n        sty.mozTransform = 'scaleX(-1)';\n        sty.msTransform = 'scaleX(-1)';\n        sty.oTransform = 'scaleX(-1)';\n        sty.transform = 'scaleX(-1)';\n        sty.filter = 'FlipH';\n        sty.msFilter = 'FlipH';\n      }\n    },\n    unflip: function () {\n      // unflip container horiz (mirror mode) if desired\n      if (this.params.flip_horiz) {\n        var sty = this.container.style;\n        sty.webkitTransform = 'scaleX(1)';\n        sty.mozTransform = 'scaleX(1)';\n        sty.msTransform = 'scaleX(1)';\n        sty.oTransform = 'scaleX(1)';\n        sty.transform = 'scaleX(1)';\n        sty.filter = '';\n        sty.msFilter = '';\n      }\n    },\n    savePreview: function (user_callback, user_canvas) {\n      // save preview freeze and fire user callback\n      var params = this.params;\n      var canvas = this.preview_canvas;\n      var context = this.preview_context; // render to user canvas if desired\n\n      if (user_canvas) {\n        var user_context = user_canvas.getContext('2d');\n        user_context.drawImage(canvas, 0, 0);\n      } // fire user callback if desired\n\n\n      user_callback(user_canvas ? null : canvas.toDataURL('image/' + params.image_format, params.jpeg_quality / 100), canvas, context); // remove preview\n\n      if (this.params.unfreeze_snap) this.unfreeze();\n    },\n    snap: function (user_callback, user_canvas) {\n      // use global callback and canvas if not defined as parameter\n      if (!user_callback) user_callback = this.params.user_callback;\n      if (!user_canvas) user_canvas = this.params.user_canvas; // take snapshot and return image data uri\n\n      var self = this;\n      var params = this.params;\n      if (!this.loaded) return this.dispatch('error', new WebcamError(\"Webcam is not loaded yet\")); // if (!this.live) return this.dispatch('error', new WebcamError(\"Webcam is not live yet\"));\n\n      if (!user_callback) return this.dispatch('error', new WebcamError(\"Please provide a callback function or canvas to snap()\")); // if we have an active preview freeze, use that\n\n      if (this.preview_active) {\n        this.savePreview(user_callback, user_canvas);\n        return null;\n      } // create offscreen canvas element to hold pixels\n\n\n      var canvas = document.createElement('canvas');\n      canvas.width = this.params.dest_width;\n      canvas.height = this.params.dest_height;\n      var context = canvas.getContext('2d'); // flip canvas horizontally if desired\n\n      if (this.params.flip_horiz) {\n        context.translate(params.dest_width, 0);\n        context.scale(-1, 1);\n      } // create inline function, called after image load (flash) or immediately (native)\n\n\n      var func = function () {\n        // render image if needed (flash)\n        if (this.src && this.width && this.height) {\n          context.drawImage(this, 0, 0, params.dest_width, params.dest_height);\n        } // crop if desired\n\n\n        if (params.crop_width && params.crop_height) {\n          var crop_canvas = document.createElement('canvas');\n          crop_canvas.width = params.crop_width;\n          crop_canvas.height = params.crop_height;\n          var crop_context = crop_canvas.getContext('2d');\n          crop_context.drawImage(canvas, Math.floor(params.dest_width / 2 - params.crop_width / 2), Math.floor(params.dest_height / 2 - params.crop_height / 2), params.crop_width, params.crop_height, 0, 0, params.crop_width, params.crop_height); // swap canvases\n\n          context = crop_context;\n          canvas = crop_canvas;\n        } // render to user canvas if desired\n\n\n        if (user_canvas) {\n          var user_context = user_canvas.getContext('2d');\n          user_context.drawImage(canvas, 0, 0);\n        } // fire user callback if desired\n\n\n        user_callback(user_canvas ? null : canvas.toDataURL('image/' + params.image_format, params.jpeg_quality / 100), canvas, context);\n      }; // grab image frame from userMedia or flash movie\n\n\n      if (this.userMedia) {\n        // native implementation\n        context.drawImage(this.video, 0, 0, this.params.dest_width, this.params.dest_height); // fire callback right away\n\n        func();\n      } else if (this.iOS) {\n        var div = document.getElementById(this.container.id + '-ios_div');\n        var img = document.getElementById(this.container.id + '-ios_img');\n        var input = document.getElementById(this.container.id + '-ios_input'); // function for handle snapshot event (call user_callback and reset the interface)\n\n        iFunc = function (event) {\n          func.call(img);\n          img.removeEventListener('load', iFunc);\n          div.style.backgroundImage = 'none';\n          img.removeAttribute('src');\n          input.value = null;\n        };\n\n        if (!input.value) {\n          // No image selected yet, activate input field\n          img.addEventListener('load', iFunc);\n          input.style.display = 'block';\n          input.focus();\n          input.click();\n          input.style.display = 'none';\n        } else {\n          // Image already selected\n          iFunc(null);\n        }\n      } else {\n        // flash fallback\n        var raw_data = this.getMovie()._snap(); // render to image, fire callback when complete\n\n\n        var img = new Image();\n        img.onload = func;\n        img.src = 'data:image/' + this.params.image_format + ';base64,' + raw_data;\n      }\n\n      return null;\n    },\n    configure: function (panel) {\n      // open flash configuration panel -- specify tab name:\n      // \"camera\", \"privacy\", \"default\", \"localStorage\", \"microphone\", \"settingsManager\"\n      if (!panel) panel = \"camera\";\n\n      this.getMovie()._configure(panel);\n    },\n    flashNotify: function (type, msg) {\n      // receive notification from flash about event\n      switch (type) {\n        case 'flashLoadComplete':\n          // movie loaded successfully\n          this.loaded = true;\n          this.dispatch('load');\n          break;\n\n        case 'cameraLive':\n          // camera is live and ready to snap\n          this.live = true;\n          this.dispatch('live');\n          break;\n\n        case 'error':\n          // Flash error\n          this.dispatch('error', new FlashError(msg));\n          break;\n\n        default:\n          // catch-all event, just in case\n          // console.log(\"webcam flash_notify: \" + type + \": \" + msg);\n          break;\n      }\n    },\n    b64ToUint6: function (nChr) {\n      // convert base64 encoded character to 6-bit integer\n      // from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Base64_encoding_and_decoding\n      return nChr > 64 && nChr < 91 ? nChr - 65 : nChr > 96 && nChr < 123 ? nChr - 71 : nChr > 47 && nChr < 58 ? nChr + 4 : nChr === 43 ? 62 : nChr === 47 ? 63 : 0;\n    },\n    base64DecToArr: function (sBase64, nBlocksSize) {\n      // convert base64 encoded string to Uintarray\n      // from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Base64_encoding_and_decoding\n      var sB64Enc = sBase64.replace(/[^A-Za-z0-9\\+\\/]/g, \"\"),\n          nInLen = sB64Enc.length,\n          nOutLen = nBlocksSize ? Math.ceil((nInLen * 3 + 1 >> 2) / nBlocksSize) * nBlocksSize : nInLen * 3 + 1 >> 2,\n          taBytes = new Uint8Array(nOutLen);\n\n      for (var nMod3, nMod4, nUint24 = 0, nOutIdx = 0, nInIdx = 0; nInIdx < nInLen; nInIdx++) {\n        nMod4 = nInIdx & 3;\n        nUint24 |= this.b64ToUint6(sB64Enc.charCodeAt(nInIdx)) << 18 - 6 * nMod4;\n\n        if (nMod4 === 3 || nInLen - nInIdx === 1) {\n          for (nMod3 = 0; nMod3 < 3 && nOutIdx < nOutLen; nMod3++, nOutIdx++) {\n            taBytes[nOutIdx] = nUint24 >>> (16 >>> nMod3 & 24) & 255;\n          }\n\n          nUint24 = 0;\n        }\n      }\n\n      return taBytes;\n    },\n    upload: function (image_data_uri, target_url, callback) {\n      // submit image data to server using binary AJAX\n      var form_elem_name = this.params.upload_name || 'webcam'; // detect image format from within image_data_uri\n\n      var image_fmt = '';\n      if (image_data_uri.match(/^data\\:image\\/(\\w+)/)) image_fmt = RegExp.$1;else throw \"Cannot locate image format in Data URI\"; // extract raw base64 data from Data URI\n\n      var raw_image_data = image_data_uri.replace(/^data\\:image\\/\\w+\\;base64\\,/, ''); // contruct use AJAX object\n\n      var http = new XMLHttpRequest();\n      http.open(\"POST\", target_url, true); // setup progress events\n\n      if (http.upload && http.upload.addEventListener) {\n        http.upload.addEventListener('progress', function (e) {\n          if (e.lengthComputable) {\n            var progress = e.loaded / e.total;\n            Webcam.dispatch('uploadProgress', progress, e);\n          }\n        }, false);\n      } // completion handler\n\n\n      var self = this;\n\n      http.onload = function () {\n        if (callback) callback.apply(self, [http.status, http.responseText, http.statusText]);\n        Webcam.dispatch('uploadComplete', http.status, http.responseText, http.statusText);\n      }; // create a blob and decode our base64 to binary\n\n\n      var blob = new Blob([this.base64DecToArr(raw_image_data)], {\n        type: 'image/' + image_fmt\n      }); // stuff into a form, so servers can easily receive it as a standard file upload\n\n      var form = new FormData();\n      form.append(form_elem_name, blob, form_elem_name + \".\" + image_fmt.replace(/e/, '')); // send data to server\n\n      http.send(form);\n    }\n  };\n  Webcam.init();\n\n  if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return Webcam;\n    });\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = Webcam;\n  } else {\n    window.Webcam = Webcam;\n  }\n})(window);","map":{"version":3,"sources":["/Users/kromate/Desktop/faceReg/src/helper/webcam.js"],"names":["window","_userMedia","FlashError","temp","Error","apply","arguments","name","stack","message","WebcamError","IntermediateInheritor","prototype","Webcam","version","protocol","location","match","loaded","live","userMedia","iOS","test","navigator","userAgent","MSStream","params","width","height","dest_width","dest_height","image_format","jpeg_quality","enable_flash","force_flash","flip_horiz","fps","upload_name","constraints","swfURL","flashNotDetectedText","noInterfaceFoundText","unfreeze_snap","iosPlaceholderText","user_callback","user_canvas","errors","hooks","init","self","mediaDevices","getUserMedia","mozGetUserMedia","webkitGetUserMedia","c","Promise","y","n","call","URL","webkitURL","mozURL","msURL","parseInt","RegExp","$1","addEventListener","event","reset","exifOrientation","binFile","dataView","DataView","getUint8","console","log","offset","marker","byteLength","str","String","fromCharCode","bigEnd","getUint16","firstIFDOffset","getUint32","dataStart","entries","i","entryOffset","valueType","numValues","value","fixOrientation","origObjURL","orientation","targetImg","img","Image","canvas","document","createElement","ctx","getContext","transform","drawImage","src","toDataURL","attach","elem","getElementById","querySelector","dispatch","container","innerHTML","peg","appendChild","offsetWidth","offsetHeight","undefined","scaleX","scaleY","video","setAttribute","style","overflow","webkitTransformOrigin","mozTransformOrigin","msTransformOrigin","oTransformOrigin","transformOrigin","webkitTransform","mozTransform","msTransform","oTransform","mandatory","minWidth","minHeight","then","stream","onloadedmetadata","e","flip","srcObject","createObjectURL","catch","err","detectFlash","setTimeout","div","id","className","textAlign","display","verticalAlign","backgroundRepeat","backgroundSize","backgroundPosition","span","input","target","files","length","type","indexOf","objURL","image","ratio","Math","min","sw","sh","sx","sy","dataURL","backgroundImage","fileReader","FileReader","result","http","XMLHttpRequest","open","responseType","onload","status","readAsArrayBuffer","response","send","snap","focus","click","getSWFHTML","crop_width","crop_height","scaled_crop_width","floor","scaled_crop_height","scrollLeft","scrollTop","preview_active","unfreeze","unflip","getVideoTracks","tracks","stop","movie","getMovie","_releaseCamera","set","key","on","callback","replace","toLowerCase","push","off","idx","splice","args","Array","slice","len","hook","toString","alert","setSWFLocation","SHOCKWAVE_FLASH","SHOCKWAVE_FLASH_AX","FLASH_MIME_TYPE","win","nav","hasFlash","plugins","desc","description","mimeTypes","enabledPlugin","ActiveXObject","ax","ver","GetVariable","html","base_url","scpts","getElementsByTagName","getAttribute","localStorage","getItem","new_user","setItem","flashvars","escape","_snap","freeze","final_width","final_height","preview_canvas","preview_context","position","left","top","insertBefore","removeChild","sty","filter","msFilter","savePreview","context","user_context","translate","scale","func","crop_canvas","crop_context","iFunc","removeEventListener","removeAttribute","raw_data","configure","panel","_configure","flashNotify","msg","b64ToUint6","nChr","base64DecToArr","sBase64","nBlocksSize","sB64Enc","nInLen","nOutLen","ceil","taBytes","Uint8Array","nMod3","nMod4","nUint24","nOutIdx","nInIdx","charCodeAt","upload","image_data_uri","target_url","form_elem_name","image_fmt","raw_image_data","lengthComputable","progress","total","responseText","statusText","blob","Blob","form","FormData","append","define","amd","module","exports"],"mappings":"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","sourcesContent":["// WebcamJS v1.0.25\n// Webcam library for capturing JPEG/PNG images in JavaScript\n// Attempts get UserMedia,falls back to Flash       \n// Author: Joseph Huckaby: http://github.com/jhuckaby\n// Based on JPEGCam: http://code.google.com/p/jpegcam/\n// Copyright (c) 2012 - 2017 Joseph Huckaby\n// Licensed under the MIT License\n\n/* eslint-disable */\n\n(function (window) {\n  var _userMedia;\n\n  // declare error types\n\n  // inheritance pattern here:\n  // https://stackoverflow.com/questions/783818/how-do-i-create-a-custom-error-in-javascript\n  function FlashError() {\n    var temp = Error.apply(this, arguments);\n    temp.name = this.name = \"FlashError\";\n    this.stack = temp.stack;\n    this.message = temp.message;\n  }\n\n  function WebcamError() {\n    var temp = Error.apply(this, arguments);\n    temp.name = this.name = \"WebcamError\";\n    this.stack = temp.stack;\n    this.message = temp.message;\n  }\n\n  var IntermediateInheritor = function () { };\n  IntermediateInheritor.prototype = Error.prototype;\n\n  FlashError.prototype = new IntermediateInheritor();\n  WebcamError.prototype = new IntermediateInheritor();\n\n  var Webcam = {\n    version: '1.0.25',\n\n    // globals\n    protocol: location.protocol.match(/https/i) ? 'https' : 'http',\n    loaded: false,   // true when webcam movie finishes loading\n    live: false,     // true when webcam is initialized and ready to snap\n    userMedia: true, // true when getUserMedia is supported natively\n\n    iOS: /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,\n\n    params: {\n      width: 0,\n      height: 0,\n      dest_width: 0,         // size of captured image\n      dest_height: 0,        // these default to width/height\n      image_format: 'png',  // image format (may be jpeg or png)\n      jpeg_quality: 100,      // jpeg image quality from 0 (worst) to 100 (best)\n      enable_flash: true,    // enable flash fallback,\n      force_flash: false,    // force flash mode,\n      flip_horiz: false,     // flip image horiz (mirror mode)\n      fps: 30,               // camera frames per second\n      upload_name: 'webcam', // name of file in upload post data\n      constraints: null,     // custom user media constraints,\n      swfURL: '',            // URI to webcam.swf movie (defaults to the js location)\n      flashNotDetectedText: 'ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).',\n      noInterfaceFoundText: 'No supported webcam interface found.',\n      unfreeze_snap: true,    // Whether to unfreeze the camera after snap (defaults to true)\n      iosPlaceholderText: 'Click here to open camera.',\n      user_callback: null,    // callback function for snapshot (used if no user_callback parameter given to snap function)\n      user_canvas: null       // user provided canvas for snapshot (used if no user_canvas parameter given to snap function)\n    },\n\n    errors: {\n      FlashError: FlashError,\n      WebcamError: WebcamError\n    },\n\n    hooks: {}, // callback hook functions\n\n    init: function () {\n      // initialize, check for getUserMedia support\n      var self = this;\n\n      // Setup getUserMedia, with polyfill for older browsers\n      // Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n      this.mediaDevices = (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) ?\n        navigator.mediaDevices : ((navigator.mozGetUserMedia || navigator.webkitGetUserMedia) ? {\n          getUserMedia: function (c) {\n            return new Promise(function (y, n) {\n              (navigator.mozGetUserMedia ||\n                navigator.webkitGetUserMedia).call(navigator, c, y, n);\n            });\n          }\n        } : null);\n\n      window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n      this.userMedia = this.userMedia && !!this.mediaDevices && !!window.URL;\n\n      if (this.iOS) {\n        this.userMedia = null;\n      }\n\n      // Older versions of firefox (< 21) apparently claim support but user media does not actually work\n      if (navigator.userAgent.match(/Firefox\\D+(\\d+)/)) {\n        if (parseInt(RegExp.$1, 10) < 21) this.userMedia = null;\n      }\n\n      // Make sure media stream is closed when navigating away from page\n      if (this.userMedia) {\n        window.addEventListener('beforeunload', function (event) {\n          self.reset();\n        });\n      }\n    },\n\n    exifOrientation: function (binFile) {\n      // extract orientation information from the image provided by iOS\n      // algorithm based on exif-js\n      var dataView = new DataView(binFile);\n      if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n        console.log('Not a valid JPEG file');\n        return 0;\n      }\n      var offset = 2;\n      var marker = null;\n      while (offset < binFile.byteLength) {\n        // find 0xFFE1 (225 marker)\n        if (dataView.getUint8(offset) != 0xFF) {\n          console.log('Not a valid marker at offset ' + offset + ', found: ' + dataView.getUint8(offset));\n          return 0;\n        }\n        marker = dataView.getUint8(offset + 1);\n        if (marker == 225) {\n          offset += 4;\n          var str = \"\";\n          for (n = 0; n < 4; n++) {\n            str += String.fromCharCode(dataView.getUint8(offset + n));\n          }\n          if (str != 'Exif') {\n            console.log('Not valid EXIF data found');\n            return 0;\n          }\n\n          offset += 6; // tiffOffset\n          var bigEnd = null;\n\n          // test for TIFF validity and endianness\n          if (dataView.getUint16(offset) == 0x4949) {\n            bigEnd = false;\n          } else if (dataView.getUint16(offset) == 0x4D4D) {\n            bigEnd = true;\n          } else {\n            console.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\n            return 0;\n          }\n\n          if (dataView.getUint16(offset + 2, !bigEnd) != 0x002A) {\n            console.log(\"Not valid TIFF data! (no 0x002A)\");\n            return 0;\n          }\n\n          var firstIFDOffset = dataView.getUint32(offset + 4, !bigEnd);\n          if (firstIFDOffset < 0x00000008) {\n            console.log(\"Not valid TIFF data! (First offset less than 8)\", dataView.getUint32(offset + 4, !bigEnd));\n            return 0;\n          }\n\n          // extract orientation data\n          var dataStart = offset + firstIFDOffset;\n          var entries = dataView.getUint16(dataStart, !bigEnd);\n          for (var i = 0; i < entries; i++) {\n            var entryOffset = dataStart + i * 12 + 2;\n            if (dataView.getUint16(entryOffset, !bigEnd) == 0x0112) {\n              var valueType = dataView.getUint16(entryOffset + 2, !bigEnd);\n              var numValues = dataView.getUint32(entryOffset + 4, !bigEnd);\n              if (valueType != 3 && numValues != 1) {\n                console.log('Invalid EXIF orientation value type (' + valueType + ') or count (' + numValues + ')');\n                return 0;\n              }\n              var value = dataView.getUint16(entryOffset + 8, !bigEnd);\n              if (value < 1 || value > 8) {\n                console.log('Invalid EXIF orientation value (' + value + ')');\n                return 0;\n              }\n              return value;\n            }\n          }\n        } else {\n          offset += 2 + dataView.getUint16(offset + 2);\n        }\n      }\n      return 0;\n    },\n\n    fixOrientation: function (origObjURL, orientation, targetImg) {\n      // fix image orientation based on exif orientation data\n      // exif orientation information\n      //    http://www.impulseadventure.com/photo/exif-orientation.html\n      //    link source wikipedia (https://en.wikipedia.org/wiki/Exif#cite_note-20)\n      var img = new Image();\n      img.addEventListener('load', function (event) {\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n\n        // switch width height if orientation needed\n        if (orientation < 5) {\n          canvas.width = img.width;\n          canvas.height = img.height;\n        } else {\n          canvas.width = img.height;\n          canvas.height = img.width;\n        }\n\n        // transform (rotate) image - see link at beginning this method\n        switch (orientation) {\n          case 2: ctx.transform(-1, 0, 0, 1, img.width, 0); break;\n          case 3: ctx.transform(-1, 0, 0, -1, img.width, img.height); break;\n          case 4: ctx.transform(1, 0, 0, -1, 0, img.height); break;\n          case 5: ctx.transform(0, 1, 1, 0, 0, 0); break;\n          case 6: ctx.transform(0, 1, -1, 0, img.height, 0); break;\n          case 7: ctx.transform(0, -1, -1, 0, img.height, img.width); break;\n          case 8: ctx.transform(0, -1, 1, 0, 0, img.width); break;\n        }\n\n        ctx.drawImage(img, 0, 0);\n        // pass rotated image data to the target image container\n        targetImg.src = canvas.toDataURL();\n      }, false);\n      // start transformation by load event\n      img.src = origObjURL;\n    },\n\n    attach: function (elem) {\n      // create webcam preview and attach to DOM element\n      // pass in actual DOM reference, ID, or CSS selector\n      if (typeof (elem) == 'string') {\n        elem = document.getElementById(elem) || document.querySelector(elem);\n      }\n      if (!elem) {\n        return this.dispatch('error', new WebcamError(\"Could not locate DOM element to attach to.\"));\n      }\n      this.container = elem;\n      elem.innerHTML = ''; // start with empty element\n\n      // insert \"peg\" so we can insert our preview canvas adjacent to it later on\n      var peg = document.createElement('div');\n      elem.appendChild(peg);\n      this.peg = peg;\n\n      // set width/height if not already set\n      if (!this.params.width) this.params.width = elem.offsetWidth;\n      if (!this.params.height) this.params.height = elem.offsetHeight;\n\n      // make sure we have a nonzero width and height at this point\n      if (!this.params.width || !this.params.height) {\n        return this.dispatch('error', new WebcamError(\"No width and/or height for webcam.  Please call set() first, or attach to a visible element.\"));\n      }\n\n      // set defaults for dest_width / dest_height if not set\n      if (!this.params.dest_width) this.params.dest_width = this.params.width;\n      if (!this.params.dest_height) this.params.dest_height = this.params.height;\n\n      this.userMedia = _userMedia === undefined ? this.userMedia : _userMedia;\n      // if force_flash is set, disable userMedia\n      if (this.params.force_flash) {\n        _userMedia = this.userMedia;\n        this.userMedia = null;\n      }\n\n      // check for default fps\n      if (typeof this.params.fps !== \"number\") this.params.fps = 30;\n\n      // adjust scale if dest_width or dest_height is different\n      var scaleX = this.params.width / this.params.dest_width;\n      var scaleY = this.params.height / this.params.dest_height;\n\n      if (this.userMedia) {\n        // setup webcam video container\n        var video = document.createElement('video');\n        video.setAttribute('autoplay', 'autoplay');\n        video.style.width = '' + this.params.dest_width + 'px';\n        video.style.height = '' + this.params.dest_height + 'px';\n\n        if ((scaleX != 1.0) || (scaleY != 1.0)) {\n          elem.style.overflow = 'hidden';\n          video.style.webkitTransformOrigin = '0px 0px';\n          video.style.mozTransformOrigin = '0px 0px';\n          video.style.msTransformOrigin = '0px 0px';\n          video.style.oTransformOrigin = '0px 0px';\n          video.style.transformOrigin = '0px 0px';\n          video.style.webkitTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.mozTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.msTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.oTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n          video.style.transform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        }\n\n        // add video element to dom\n        elem.appendChild(video);\n        this.video = video;\n\n        // ask user for access to their camera\n        var self = this;\n        this.mediaDevices.getUserMedia({\n          \"audio\": false,\n          \"video\": this.params.constraints || {\n            mandatory: {\n              minWidth: this.params.dest_width,\n              minHeight: this.params.dest_height\n            }\n          }\n        })\n          .then(function (stream) {\n            // got access, attach stream to video\n            video.onloadedmetadata = function (e) {\n              self.stream = stream;\n              self.loaded = true;\n              self.live = true;\n              self.dispatch('load');\n              self.dispatch('live');\n              self.flip();\n            };\n            // as window.URL.createObjectURL() is deprecated, adding a check so that it works in Safari.\n            // older browsers may not have srcObject\n            if (\"srcObject\" in video) {\n              video.srcObject = stream;\n            }\n            else {\n              // using URL.createObjectURL() as fallback for old browsers\n              video.src = window.URL.createObjectURL(stream);\n            }\n          })\n          .catch(function (err) {\n            // JH 2016-07-31 Instead of dispatching error, now falling back to Flash if userMedia fails (thx @john2014)\n            // JH 2016-08-07 But only if flash is actually installed -- if not, dispatch error here and now.\n            if (self.params.enable_flash && self.detectFlash()) {\n              setTimeout(function () { self.params.force_flash = 1; self.attach(elem); }, 1);\n            }\n            else {\n              self.dispatch('error', err);\n            }\n          });\n      }\n      else if (this.iOS) {\n        // prepare HTML elements\n        var div = document.createElement('div');\n        div.id = this.container.id + '-ios_div';\n        div.className = 'webcamjs-ios-placeholder';\n        div.style.width = '' + this.params.width + 'px';\n        div.style.height = '' + this.params.height + 'px';\n        div.style.textAlign = 'center';\n        div.style.display = 'table-cell';\n        div.style.verticalAlign = 'middle';\n        div.style.backgroundRepeat = 'no-repeat';\n        div.style.backgroundSize = 'contain';\n        div.style.backgroundPosition = 'center';\n        var span = document.createElement('span');\n        span.className = 'webcamjs-ios-text';\n        span.innerHTML = this.params.iosPlaceholderText;\n        div.appendChild(span);\n        var img = document.createElement('img');\n        img.id = this.container.id + '-ios_img';\n        img.style.width = '' + this.params.dest_width + 'px';\n        img.style.height = '' + this.params.dest_height + 'px';\n        img.style.display = 'none';\n        div.appendChild(img);\n        var input = document.createElement('input');\n        input.id = this.container.id + '-ios_input';\n        input.setAttribute('type', 'file');\n        input.setAttribute('accept', 'image/*');\n        input.setAttribute('capture', 'camera');\n\n        var self = this;\n        var params = this.params;\n        // add input listener to load the selected image\n        input.addEventListener('change', function (event) {\n          if (event.target.files.length > 0 && event.target.files[0].type.indexOf('image/') == 0) {\n            var objURL = URL.createObjectURL(event.target.files[0]);\n\n            // load image with auto scale and crop\n            var image = new Image();\n            image.addEventListener('load', function (event) {\n              var canvas = document.createElement('canvas');\n              canvas.width = params.dest_width;\n              canvas.height = params.dest_height;\n              var ctx = canvas.getContext('2d');\n\n              // crop and scale image for final size\n              ratio = Math.min(image.width / params.dest_width, image.height / params.dest_height);\n              var sw = params.dest_width * ratio;\n              var sh = params.dest_height * ratio;\n              var sx = (image.width - sw) / 2;\n              var sy = (image.height - sh) / 2;\n              ctx.drawImage(image, sx, sy, sw, sh, 0, 0, params.dest_width, params.dest_height);\n\n              var dataURL = canvas.toDataURL();\n              img.src = dataURL;\n              div.style.backgroundImage = \"url('\" + dataURL + \"')\";\n            }, false);\n\n            // read EXIF data\n            var fileReader = new FileReader();\n            fileReader.addEventListener('load', function (e) {\n              var orientation = self.exifOrientation(e.target.result);\n              if (orientation > 1) {\n                // image need to rotate (see comments on fixOrientation method for more information)\n                // transform image and load to image object\n                self.fixOrientation(objURL, orientation, image);\n              } else {\n                // load image data to image object\n                image.src = objURL;\n              }\n            }, false);\n\n            // Convert image data to blob format\n            var http = new XMLHttpRequest();\n            http.open(\"GET\", objURL, true);\n            http.responseType = \"blob\";\n            http.onload = function (e) {\n              if (this.status == 200 || this.status === 0) {\n                fileReader.readAsArrayBuffer(this.response);\n              }\n            };\n            http.send();\n\n          }\n        }, false);\n        input.style.display = 'none';\n        elem.appendChild(input);\n        // make div clickable for open camera interface\n        div.addEventListener('click', function (event) {\n          if (params.user_callback) {\n            // global user_callback defined - create the snapshot\n            self.snap(params.user_callback, params.user_canvas);\n          } else {\n            // no global callback definied for snapshot, load image and wait for external snap method call\n            input.style.display = 'block';\n            input.focus();\n            input.click();\n            input.style.display = 'none';\n          }\n        }, false);\n        elem.appendChild(div);\n        this.loaded = true;\n        this.live = true;\n      }\n      else if (this.params.enable_flash && this.detectFlash()) {\n        // flash fallback\n        window.Webcam = Webcam; // needed for flash-to-js interface\n        var div = document.createElement('div');\n        div.innerHTML = this.getSWFHTML();\n        elem.appendChild(div);\n      }\n      else {\n        this.dispatch('error', new WebcamError(this.params.noInterfaceFoundText));\n      }\n\n      // setup final crop for live preview\n      if (this.params.crop_width && this.params.crop_height) {\n        var scaled_crop_width = Math.floor(this.params.crop_width * scaleX);\n        var scaled_crop_height = Math.floor(this.params.crop_height * scaleY);\n\n        elem.style.width = '' + scaled_crop_width + 'px';\n        elem.style.height = '' + scaled_crop_height + 'px';\n        elem.style.overflow = 'hidden';\n\n        elem.scrollLeft = Math.floor((this.params.width / 2) - (scaled_crop_width / 2));\n        elem.scrollTop = Math.floor((this.params.height / 2) - (scaled_crop_height / 2));\n      }\n      else {\n        // no crop, set size to desired\n        elem.style.width = '' + this.params.width + 'px';\n        elem.style.height = '' + this.params.height + 'px';\n      }\n    },\n\n    reset: function () {\n      // shutdown camera, reset to potentially attach again\n      if (this.preview_active) this.unfreeze();\n\n      // attempt to fix issue #64\n      this.unflip();\n\n      if (this.userMedia) {\n        if (this.stream) {\n          if (this.stream.getVideoTracks) {\n            // get video track to call stop on it\n            var tracks = this.stream.getVideoTracks();\n            if (tracks && tracks[0] && tracks[0].stop) tracks[0].stop();\n          }\n          else if (this.stream.stop) {\n            // deprecated, may be removed in future\n            this.stream.stop();\n          }\n        }\n        delete this.stream;\n        delete this.video;\n      }\n\n      if ((this.userMedia !== true) && this.loaded && !this.iOS) {\n        // call for turn off camera in flash\n        var movie = this.getMovie();\n        if (movie && movie._releaseCamera) movie._releaseCamera();\n      }\n\n      if (this.container) {\n        this.container.innerHTML = '';\n        delete this.container;\n      }\n\n      this.loaded = false;\n      this.live = false;\n    },\n\n    set: function () {\n      // set one or more params\n      // variable argument list: 1 param = hash, 2 params = key, value\n      if (arguments.length == 1) {\n        for (var key in arguments[0]) {\n          this.params[key] = arguments[0][key];\n        }\n      }\n      else {\n        this.params[arguments[0]] = arguments[1];\n      }\n    },\n\n    on: function (name, callback) {\n      // set callback hook\n      name = name.replace(/^on/i, '').toLowerCase();\n      if (!this.hooks[name]) this.hooks[name] = [];\n      this.hooks[name].push(callback);\n    },\n\n    off: function (name, callback) {\n      // remove callback hook\n      name = name.replace(/^on/i, '').toLowerCase();\n      if (this.hooks[name]) {\n        if (callback) {\n          // remove one selected callback from list\n          var idx = this.hooks[name].indexOf(callback);\n          if (idx > -1) this.hooks[name].splice(idx, 1);\n        }\n        else {\n          // no callback specified, so clear all\n          this.hooks[name] = [];\n        }\n      }\n    },\n\n    dispatch: function () {\n      // fire hook callback, passing optional value to it\n      var name = arguments[0].replace(/^on/i, '').toLowerCase();\n      var args = Array.prototype.slice.call(arguments, 1);\n\n      if (this.hooks[name] && this.hooks[name].length) {\n        for (var idx = 0, len = this.hooks[name].length; idx < len; idx++) {\n          var hook = this.hooks[name][idx];\n\n          if (typeof (hook) == 'function') {\n            // callback is function reference, call directly\n            hook.apply(this, args);\n          }\n          else if ((typeof (hook) == 'object') && (hook.length == 2)) {\n            // callback is PHP-style object instance method\n            hook[0][hook[1]].apply(hook[0], args);\n          }\n          else if (window[hook]) {\n            // callback is global function name\n            window[hook].apply(window, args);\n          }\n        } // loop\n        return true;\n      }\n      else if (name == 'error') {\n        var message;\n        if ((args[0] instanceof FlashError) || (args[0] instanceof WebcamError)) {\n          message = args[0].message;\n        } else {\n          message = \"Could not access webcam: \" + args[0].name + \": \" +\n            args[0].message + \" \" + args[0].toString();\n        }\n\n        // default error handler if no custom one specified\n        alert(\"Webcam.js Error: \" + message);\n      }\n\n      return false; // no hook defined\n    },\n\n    setSWFLocation: function (value) {\n      // for backward compatibility.\n      this.set('swfURL', value);\n    },\n\n    detectFlash: function () {\n      // return true if browser supports flash, false otherwise\n      // Code snippet borrowed from: https://github.com/swfobject/swfobject\n      var SHOCKWAVE_FLASH = \"Shockwave Flash\",\n        SHOCKWAVE_FLASH_AX = \"ShockwaveFlash.ShockwaveFlash\",\n        FLASH_MIME_TYPE = \"application/x-shockwave-flash\",\n        win = window,\n        nav = navigator,\n        hasFlash = false;\n\n      if (typeof nav.plugins !== \"undefined\" && typeof nav.plugins[SHOCKWAVE_FLASH] === \"object\") {\n        var desc = nav.plugins[SHOCKWAVE_FLASH].description;\n        if (desc && (typeof nav.mimeTypes !== \"undefined\" && nav.mimeTypes[FLASH_MIME_TYPE] && nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) {\n          hasFlash = true;\n        }\n      }\n      else if (typeof win.ActiveXObject !== \"undefined\") {\n        try {\n          var ax = new ActiveXObject(SHOCKWAVE_FLASH_AX);\n          if (ax) {\n            var ver = ax.GetVariable(\"$version\");\n            if (ver) hasFlash = true;\n          }\n        }\n        catch (e) {  }\n      }\n\n      return hasFlash;\n    },\n\n    getSWFHTML: function () {\n      // Return HTML for embedding flash based webcam capture movie\t\t\n      var html = '',\n        swfURL = this.params.swfURL;\n\n      // make sure we aren't running locally (flash doesn't work)\n      if (location.protocol.match(/file/)) {\n        this.dispatch('error', new FlashError(\"Flash does not work from local disk.  Please run from a web server.\"));\n        return '<h3 style=\"color:red\">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';\n      }\n\n      // make sure we have flash\n      if (!this.detectFlash()) {\n        this.dispatch('error', new FlashError(\"Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.\"));\n        return '<h3 style=\"color:red\">' + this.params.flashNotDetectedText + '</h3>';\n      }\n\n      // set default swfURL if not explicitly set\n      if (!swfURL) {\n        // find our script tag, and use that base URL\n        var base_url = '';\n        var scpts = document.getElementsByTagName('script');\n        for (var idx = 0, len = scpts.length; idx < len; idx++) {\n          var src = scpts[idx].getAttribute('src');\n          if (src && src.match(/\\/webcam(\\.min)?\\.js/)) {\n            base_url = src.replace(/\\/webcam(\\.min)?\\.js.*$/, '');\n            idx = len;\n          }\n        }\n        if (base_url) swfURL = base_url + '/webcam.swf';\n        else swfURL = 'webcam.swf';\n      }\n\n      // if this is the user's first visit, set flashvar so flash privacy settings panel is shown first\n      if (window.localStorage && !localStorage.getItem('visited')) {\n        this.params.new_user = 1;\n        localStorage.setItem('visited', 1);\n      }\n\n      // construct flashvars string\n      var flashvars = '';\n      for (var key in this.params) {\n        if (flashvars) flashvars += '&';\n        flashvars += key + '=' + escape(this.params[key]);\n      }\n\n      // construct object/embed tag\n      html += '<object classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" type=\"application/x-shockwave-flash\" codebase=\"' + this.protocol + '://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0\" width=\"' + this.params.width + '\" height=\"' + this.params.height + '\" id=\"webcam_movie_obj\" align=\"middle\"><param name=\"wmode\" value=\"opaque\" /><param name=\"allowScriptAccess\" value=\"always\" /><param name=\"allowFullScreen\" value=\"false\" /><param name=\"movie\" value=\"' + swfURL + '\" /><param name=\"loop\" value=\"false\" /><param name=\"menu\" value=\"false\" /><param name=\"quality\" value=\"best\" /><param name=\"bgcolor\" value=\"#ffffff\" /><param name=\"flashvars\" value=\"' + flashvars + '\"/><embed id=\"webcam_movie_embed\" src=\"' + swfURL + '\" wmode=\"opaque\" loop=\"false\" menu=\"false\" quality=\"best\" bgcolor=\"#ffffff\" width=\"' + this.params.width + '\" height=\"' + this.params.height + '\" name=\"webcam_movie_embed\" align=\"middle\" allowScriptAccess=\"always\" allowFullScreen=\"false\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" flashvars=\"' + flashvars + '\"></embed></object>';\n\n      return html;\n    },\n\n    getMovie: function () {\n      // get reference to movie object/embed in DOM\n      if (!this.loaded) return this.dispatch('error', new FlashError(\"Flash Movie is not loaded yet\"));\n      var movie = document.getElementById('webcam_movie_obj');\n      if (!movie || !movie._snap) movie = document.getElementById('webcam_movie_embed');\n      if (!movie) this.dispatch('error', new FlashError(\"Cannot locate Flash movie in DOM\"));\n      return movie;\n    },\n\n    freeze: function () {\n      // show preview, freeze camera\n      var self = this;\n      var params = this.params;\n\n      // kill preview if already active\n      if (this.preview_active) this.unfreeze();\n\n      // determine scale factor\n      var scaleX = this.params.width / this.params.dest_width;\n      var scaleY = this.params.height / this.params.dest_height;\n\n      // must unflip container as preview canvas will be pre-flipped\n      this.unflip();\n\n      // calc final size of image\n      var final_width = params.crop_width || params.dest_width;\n      var final_height = params.crop_height || params.dest_height;\n\n      // create canvas for holding preview\n      var preview_canvas = document.createElement('canvas');\n      preview_canvas.width = final_width;\n      preview_canvas.height = final_height;\n      var preview_context = preview_canvas.getContext('2d');\n\n      // save for later use\n      this.preview_canvas = preview_canvas;\n      this.preview_context = preview_context;\n\n      // scale for preview size\n      if ((scaleX != 1.0) || (scaleY != 1.0)) {\n        preview_canvas.style.webkitTransformOrigin = '0px 0px';\n        preview_canvas.style.mozTransformOrigin = '0px 0px';\n        preview_canvas.style.msTransformOrigin = '0px 0px';\n        preview_canvas.style.oTransformOrigin = '0px 0px';\n        preview_canvas.style.transformOrigin = '0px 0px';\n        preview_canvas.style.webkitTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.mozTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.msTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.oTransform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n        preview_canvas.style.transform = 'scaleX(' + scaleX + ') scaleY(' + scaleY + ')';\n      }\n\n      // take snapshot, but fire our own callback\n      this.snap(function () {\n        // add preview image to dom, adjust for crop\n        preview_canvas.style.position = 'relative';\n        preview_canvas.style.left = '' + self.container.scrollLeft + 'px';\n        preview_canvas.style.top = '' + self.container.scrollTop + 'px';\n\n        self.container.insertBefore(preview_canvas, self.peg);\n        self.container.style.overflow = 'hidden';\n\n        // set flag for user capture (use preview)\n        self.preview_active = true;\n\n      }, preview_canvas);\n    },\n\n    unfreeze: function () {\n      // cancel preview and resume live video feed\n      if (this.preview_active) {\n        // remove preview canvas\n        this.container.removeChild(this.preview_canvas);\n        delete this.preview_context;\n        delete this.preview_canvas;\n\n        // unflag\n        this.preview_active = false;\n\n        // re-flip if we unflipped before\n        this.flip();\n      }\n    },\n\n    flip: function () {\n      // flip container horiz (mirror mode) if desired\n      if (this.params.flip_horiz) {\n        var sty = this.container.style;\n        sty.webkitTransform = 'scaleX(-1)';\n        sty.mozTransform = 'scaleX(-1)';\n        sty.msTransform = 'scaleX(-1)';\n        sty.oTransform = 'scaleX(-1)';\n        sty.transform = 'scaleX(-1)';\n        sty.filter = 'FlipH';\n        sty.msFilter = 'FlipH';\n      }\n    },\n\n    unflip: function () {\n      // unflip container horiz (mirror mode) if desired\n      if (this.params.flip_horiz) {\n        var sty = this.container.style;\n        sty.webkitTransform = 'scaleX(1)';\n        sty.mozTransform = 'scaleX(1)';\n        sty.msTransform = 'scaleX(1)';\n        sty.oTransform = 'scaleX(1)';\n        sty.transform = 'scaleX(1)';\n        sty.filter = '';\n        sty.msFilter = '';\n      }\n    },\n\n    savePreview: function (user_callback, user_canvas) {\n      // save preview freeze and fire user callback\n      var params = this.params;\n      var canvas = this.preview_canvas;\n      var context = this.preview_context;\n\n      // render to user canvas if desired\n      if (user_canvas) {\n        var user_context = user_canvas.getContext('2d');\n        user_context.drawImage(canvas, 0, 0);\n      }\n\n      // fire user callback if desired\n      user_callback(\n        user_canvas ? null : canvas.toDataURL('image/' + params.image_format, params.jpeg_quality / 100),\n        canvas,\n        context\n      );\n\n      // remove preview\n      if (this.params.unfreeze_snap) this.unfreeze();\n    },\n\n    snap: function (user_callback, user_canvas) {\n      // use global callback and canvas if not defined as parameter\n      if (!user_callback) user_callback = this.params.user_callback;\n      if (!user_canvas) user_canvas = this.params.user_canvas;\n\n      // take snapshot and return image data uri\n      var self = this;\n      var params = this.params;\n\n      if (!this.loaded) return this.dispatch('error', new WebcamError(\"Webcam is not loaded yet\"));\n      // if (!this.live) return this.dispatch('error', new WebcamError(\"Webcam is not live yet\"));\n      if (!user_callback) return this.dispatch('error', new WebcamError(\"Please provide a callback function or canvas to snap()\"));\n\n      // if we have an active preview freeze, use that\n      if (this.preview_active) {\n        this.savePreview(user_callback, user_canvas);\n        return null;\n      }\n\n      // create offscreen canvas element to hold pixels\n      var canvas = document.createElement('canvas');\n      canvas.width = this.params.dest_width;\n      canvas.height = this.params.dest_height;\n      var context = canvas.getContext('2d');\n\n      // flip canvas horizontally if desired\n      if (this.params.flip_horiz) {\n        context.translate(params.dest_width, 0);\n        context.scale(-1, 1);\n      }\n\n      // create inline function, called after image load (flash) or immediately (native)\n      var func = function () {\n        // render image if needed (flash)\n        if (this.src && this.width && this.height) {\n          context.drawImage(this, 0, 0, params.dest_width, params.dest_height);\n        }\n\n        // crop if desired\n        if (params.crop_width && params.crop_height) {\n          var crop_canvas = document.createElement('canvas');\n          crop_canvas.width = params.crop_width;\n          crop_canvas.height = params.crop_height;\n          var crop_context = crop_canvas.getContext('2d');\n\n          crop_context.drawImage(canvas,\n            Math.floor((params.dest_width / 2) - (params.crop_width / 2)),\n            Math.floor((params.dest_height / 2) - (params.crop_height / 2)),\n            params.crop_width,\n            params.crop_height,\n            0,\n            0,\n            params.crop_width,\n            params.crop_height\n          );\n\n          // swap canvases\n          context = crop_context;\n          canvas = crop_canvas;\n        }\n\n        // render to user canvas if desired\n        if (user_canvas) {\n          var user_context = user_canvas.getContext('2d');\n          user_context.drawImage(canvas, 0, 0);\n        }\n\n        // fire user callback if desired\n        user_callback(\n          user_canvas ? null : canvas.toDataURL('image/' + params.image_format, params.jpeg_quality / 100),\n          canvas,\n          context\n        );\n      };\n\n      // grab image frame from userMedia or flash movie\n      if (this.userMedia) {\n        // native implementation\n        context.drawImage(this.video, 0, 0, this.params.dest_width, this.params.dest_height);\n\n        // fire callback right away\n        func();\n      }\n      else if (this.iOS) {\n        var div = document.getElementById(this.container.id + '-ios_div');\n        var img = document.getElementById(this.container.id + '-ios_img');\n        var input = document.getElementById(this.container.id + '-ios_input');\n        // function for handle snapshot event (call user_callback and reset the interface)\n        iFunc = function (event) {\n          func.call(img);\n          img.removeEventListener('load', iFunc);\n          div.style.backgroundImage = 'none';\n          img.removeAttribute('src');\n          input.value = null;\n        };\n        if (!input.value) {\n          // No image selected yet, activate input field\n          img.addEventListener('load', iFunc);\n          input.style.display = 'block';\n          input.focus();\n          input.click();\n          input.style.display = 'none';\n        } else {\n          // Image already selected\n          iFunc(null);\n        }\n      }\n      else {\n        // flash fallback\n        var raw_data = this.getMovie()._snap();\n\n        // render to image, fire callback when complete\n        var img = new Image();\n        img.onload = func;\n        img.src = 'data:image/' + this.params.image_format + ';base64,' + raw_data;\n      }\n\n      return null;\n    },\n\n    configure: function (panel) {\n      // open flash configuration panel -- specify tab name:\n      // \"camera\", \"privacy\", \"default\", \"localStorage\", \"microphone\", \"settingsManager\"\n      if (!panel) panel = \"camera\";\n      this.getMovie()._configure(panel);\n    },\n\n    flashNotify: function (type, msg) {\n      // receive notification from flash about event\n      switch (type) {\n        case 'flashLoadComplete':\n          // movie loaded successfully\n          this.loaded = true;\n          this.dispatch('load');\n          break;\n\n        case 'cameraLive':\n          // camera is live and ready to snap\n          this.live = true;\n          this.dispatch('live');\n          break;\n\n        case 'error':\n          // Flash error\n          this.dispatch('error', new FlashError(msg));\n          break;\n\n        default:\n          // catch-all event, just in case\n          // console.log(\"webcam flash_notify: \" + type + \": \" + msg);\n          break;\n      }\n    },\n\n    b64ToUint6: function (nChr) {\n      // convert base64 encoded character to 6-bit integer\n      // from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Base64_encoding_and_decoding\n      return nChr > 64 && nChr < 91 ? nChr - 65\n        : nChr > 96 && nChr < 123 ? nChr - 71\n          : nChr > 47 && nChr < 58 ? nChr + 4\n            : nChr === 43 ? 62 : nChr === 47 ? 63 : 0;\n    },\n\n    base64DecToArr: function (sBase64, nBlocksSize) {\n      // convert base64 encoded string to Uintarray\n      // from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Base64_encoding_and_decoding\n      var sB64Enc = sBase64.replace(/[^A-Za-z0-9\\+\\/]/g, \"\"), nInLen = sB64Enc.length,\n        nOutLen = nBlocksSize ? Math.ceil((nInLen * 3 + 1 >> 2) / nBlocksSize) * nBlocksSize : nInLen * 3 + 1 >> 2,\n        taBytes = new Uint8Array(nOutLen);\n\n      for (var nMod3, nMod4, nUint24 = 0, nOutIdx = 0, nInIdx = 0; nInIdx < nInLen; nInIdx++) {\n        nMod4 = nInIdx & 3;\n        nUint24 |= this.b64ToUint6(sB64Enc.charCodeAt(nInIdx)) << 18 - 6 * nMod4;\n        if (nMod4 === 3 || nInLen - nInIdx === 1) {\n          for (nMod3 = 0; nMod3 < 3 && nOutIdx < nOutLen; nMod3++, nOutIdx++) {\n            taBytes[nOutIdx] = nUint24 >>> (16 >>> nMod3 & 24) & 255;\n          }\n          nUint24 = 0;\n        }\n      }\n      return taBytes;\n    },\n\n    upload: function (image_data_uri, target_url, callback) {\n      // submit image data to server using binary AJAX\n      var form_elem_name = this.params.upload_name || 'webcam';\n\n      // detect image format from within image_data_uri\n      var image_fmt = '';\n      if (image_data_uri.match(/^data\\:image\\/(\\w+)/))\n        image_fmt = RegExp.$1;\n      else\n        throw \"Cannot locate image format in Data URI\";\n\n      // extract raw base64 data from Data URI\n      var raw_image_data = image_data_uri.replace(/^data\\:image\\/\\w+\\;base64\\,/, '');\n\n      // contruct use AJAX object\n      var http = new XMLHttpRequest();\n      http.open(\"POST\", target_url, true);\n\n      // setup progress events\n      if (http.upload && http.upload.addEventListener) {\n        http.upload.addEventListener('progress', function (e) {\n          if (e.lengthComputable) {\n            var progress = e.loaded / e.total;\n            Webcam.dispatch('uploadProgress', progress, e);\n          }\n        }, false);\n      }\n\n      // completion handler\n      var self = this;\n      http.onload = function () {\n        if (callback) callback.apply(self, [http.status, http.responseText, http.statusText]);\n        Webcam.dispatch('uploadComplete', http.status, http.responseText, http.statusText);\n      };\n\n      // create a blob and decode our base64 to binary\n      var blob = new Blob([this.base64DecToArr(raw_image_data)], { type: 'image/' + image_fmt });\n\n      // stuff into a form, so servers can easily receive it as a standard file upload\n      var form = new FormData();\n      form.append(form_elem_name, blob, form_elem_name + \".\" + image_fmt.replace(/e/, ''));\n\n      // send data to server\n      http.send(form);\n    }\n\n  };\n\n  Webcam.init();\n\n  if (typeof define === 'function' && define.amd) {\n    define(function () { return Webcam; });\n  }\n  else if (typeof module === 'object' && module.exports) {\n    module.exports = Webcam;\n  }\n  else {\n    window.Webcam = Webcam;\n  }\n\n}(window));"]},"metadata":{},"sourceType":"module"}