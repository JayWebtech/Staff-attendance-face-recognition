{"ast":null,"code":"const Webcam = require('../helper/webcam');\n\nimport { ref } from 'vue';\nimport { globalState } from './useState';\n\nconst faceapi = require('../helper/faceApi.min.js');\n\nlet snappedFace = ref().value;\n\nfunction loadLabeledImages() {\n  console.log(globalState);\n  return Promise.all(labels.map(async label => {\n    const descriptions = [];\n\n    for (let i = 1; i <= 2; i++) {\n      console.log(student[label]);\n      const img = await faceapi.fetchImage(student[label]);\n      const detections = await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor();\n      descriptions.push(detections.descriptor);\n    }\n\n    return new faceapi.LabeledFaceDescriptors(label, descriptions);\n  }));\n}\n\nconst scanImg = async () => {\n  const image = snappedFace;\n  const container = document.createElement('div');\n  container.style.position = 'relative';\n  document.body.append(container);\n  const labeledFaceDescriptors = await loadLabeledImages();\n  const faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors, 0.4);\n  const canvas = faceapi.createCanvasFromMedia(image);\n  document.body.append(canvas);\n  const displaySize = {\n    width: image.width,\n    height: image.height\n  };\n  faceapi.matchDimensions(canvas, displaySize);\n  const detection = await faceapi.detectAllFaces(image).withFaceLandmarks().withFaceDescriptors();\n\n  if (detection.length < 1) {\n    location.reload();\n  } else {\n    const resizedDetections = faceapi.resizeResults(detection, displaySize);\n    const results = resizedDetections.map(d => faceMatcher.findBestMatch(d.descriptor));\n    results.forEach((result, i) => {\n      const box = resizedDetections[i].detection.box;\n      const drawBox = new faceapi.draw.DrawBox(box, {\n        label: result.toString()\n      });\n      console.log(result._label);\n      drawBox.draw(canvas);\n      db.collection('students').doc(`${result._label}`).update({\n        date: firebase.firestore.FieldValue.arrayUnion(`${new Date().toLocaleTimeString()} of ${new Date().toLocaleDateString()}`)\n      }).then(() => {\n        window.location.assign('./index.html');\n      });\n    });\n  }\n};\n\nexport const SnapFace = () => {\n  const video = document.querySelector('#video');\n  let recog;\n  video.addEventListener('play', () => {\n    const canvas = faceapi.createCanvasFromMedia(video);\n    document.body.append(canvas);\n    const displaySize = {\n      width: video.width,\n      height: video.height\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    recog = setInterval(async () => {\n      try {\n        const detections = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n        const resizedDetections = faceapi.resizeResults(detections, displaySize);\n        canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n        faceapi.draw.drawDetections(canvas, resizedDetections);\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);\n\n        if (resizedDetections.detection.score.toFixed(2) > 0.7) {\n          await clearInterval(recog);\n          canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n          document.querySelector('#alert').style.color = 'green';\n          document.querySelector('#alert').innerHTML = 'Face found';\n          Webcam.snap(function (data_uri) {\n            snappedFace = data_uri;\n          });\n          await scanImg();\n        } else {\n          document.querySelector('#alert').style.color = 'red';\n          document.querySelector('#alert').innerHTML = 'Can\\'t find a Face, Please Adjust';\n        }\n      } catch (err) {\n        console.log('something went wrong ====', err);\n      }\n    }, 1000);\n  });\n};","map":{"version":3,"sources":["/Users/kromate/Desktop/faceReg/fas/src/composibles/useAttendance.js"],"names":["Webcam","require","ref","globalState","faceapi","snappedFace","value","loadLabeledImages","console","log","Promise","all","labels","map","label","descriptions","i","student","img","fetchImage","detections","detectSingleFace","withFaceLandmarks","withFaceDescriptor","push","descriptor","LabeledFaceDescriptors","scanImg","image","container","document","createElement","style","position","body","append","labeledFaceDescriptors","faceMatcher","FaceMatcher","canvas","createCanvasFromMedia","displaySize","width","height","matchDimensions","detection","detectAllFaces","withFaceDescriptors","length","location","reload","resizedDetections","resizeResults","results","d","findBestMatch","forEach","result","box","drawBox","draw","DrawBox","toString","_label","db","collection","doc","update","date","firebase","firestore","FieldValue","arrayUnion","Date","toLocaleTimeString","toLocaleDateString","then","window","assign","SnapFace","video","querySelector","recog","addEventListener","setInterval","TinyFaceDetectorOptions","withFaceExpressions","getContext","clearRect","drawDetections","drawFaceLandmarks","score","toFixed","clearInterval","color","innerHTML","snap","data_uri","err"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,kBAAD,CAAtB;;AACA,SAASC,GAAT,QAAoB,KAApB;AACA,SAASC,WAAT,QAA4B,YAA5B;;AACA,MAAMC,OAAO,GAAGH,OAAO,CAAC,0BAAD,CAAvB;;AAEA,IAAII,WAAW,GAAGH,GAAG,GAAGI,KAAxB;;AAGA,SAASC,iBAAT,GAA6B;AAC5BC,EAAAA,OAAO,CAACC,GAAR,CAAYN,WAAZ;AACA,SAAOO,OAAO,CAACC,GAAR,CACNC,MAAM,CAACC,GAAP,CAAW,MAAOC,KAAP,IAAiB;AAC3B,UAAMC,YAAY,GAAG,EAArB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AAC5BR,MAAAA,OAAO,CAACC,GAAR,CAAYQ,OAAO,CAACH,KAAD,CAAnB;AACA,YAAMI,GAAG,GAAG,MAAMd,OAAO,CAACe,UAAR,CAAmBF,OAAO,CAACH,KAAD,CAA1B,CAAlB;AACA,YAAMM,UAAU,GAAG,MAAMhB,OAAO,CAACiB,gBAAR,CAAyBH,GAAzB,EAA8BI,iBAA9B,GAAkDC,kBAAlD,EAAzB;AACAR,MAAAA,YAAY,CAACS,IAAb,CAAkBJ,UAAU,CAACK,UAA7B;AACA;;AAED,WAAO,IAAIrB,OAAO,CAACsB,sBAAZ,CAAmCZ,KAAnC,EAA0CC,YAA1C,CAAP;AACA,GAVD,CADM,CAAP;AAaA;;AAED,MAAMY,OAAO,GAAG,YAAU;AAEzB,QAAMC,KAAK,GAAGvB,WAAd;AACA,QAAMwB,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAF,EAAAA,SAAS,CAACG,KAAV,CAAgBC,QAAhB,GAA2B,UAA3B;AACAH,EAAAA,QAAQ,CAACI,IAAT,CAAcC,MAAd,CAAqBN,SAArB;AACA,QAAMO,sBAAsB,GAAG,MAAM7B,iBAAiB,EAAtD;AACA,QAAM8B,WAAW,GAAG,IAAIjC,OAAO,CAACkC,WAAZ,CAAwBF,sBAAxB,EAAgD,GAAhD,CAApB;AAEA,QAAMG,MAAM,GAAGnC,OAAO,CAACoC,qBAAR,CAA8BZ,KAA9B,CAAf;AACAE,EAAAA,QAAQ,CAACI,IAAT,CAAcC,MAAd,CAAqBI,MAArB;AACA,QAAME,WAAW,GAAG;AAAEC,IAAAA,KAAK,EAAEd,KAAK,CAACc,KAAf;AAAsBC,IAAAA,MAAM,EAAEf,KAAK,CAACe;AAApC,GAApB;AACAvC,EAAAA,OAAO,CAACwC,eAAR,CAAwBL,MAAxB,EAAgCE,WAAhC;AACA,QAAMI,SAAS,GAAG,MAAMzC,OAAO,CAAC0C,cAAR,CAAuBlB,KAAvB,EAA8BN,iBAA9B,GAAkDyB,mBAAlD,EAAxB;;AACA,MAAIF,SAAS,CAACG,MAAV,GAAmB,CAAvB,EAA0B;AACzBC,IAAAA,QAAQ,CAACC,MAAT;AACA,GAFD,MAEO;AACN,UAAMC,iBAAiB,GAAG/C,OAAO,CAACgD,aAAR,CAAsBP,SAAtB,EAAiCJ,WAAjC,CAA1B;AACA,UAAMY,OAAO,GAAGF,iBAAiB,CAACtC,GAAlB,CAAuByC,CAAD,IAAOjB,WAAW,CAACkB,aAAZ,CAA0BD,CAAC,CAAC7B,UAA5B,CAA7B,CAAhB;AACA4B,IAAAA,OAAO,CAACG,OAAR,CAAgB,CAACC,MAAD,EAASzC,CAAT,KAAe;AAC9B,YAAM0C,GAAG,GAAGP,iBAAiB,CAACnC,CAAD,CAAjB,CAAqB6B,SAArB,CAA+Ba,GAA3C;AACA,YAAMC,OAAO,GAAG,IAAIvD,OAAO,CAACwD,IAAR,CAAaC,OAAjB,CAAyBH,GAAzB,EAA8B;AAAE5C,QAAAA,KAAK,EAAE2C,MAAM,CAACK,QAAP;AAAT,OAA9B,CAAhB;AACAtD,MAAAA,OAAO,CAACC,GAAR,CAAYgD,MAAM,CAACM,MAAnB;AACAJ,MAAAA,OAAO,CAACC,IAAR,CAAarB,MAAb;AACAyB,MAAAA,EAAE,CAACC,UAAH,CAAc,UAAd,EAA0BC,GAA1B,CAA+B,GAAET,MAAM,CAACM,MAAO,EAA/C,EAAkDI,MAAlD,CAAyD;AACxDC,QAAAA,IAAI,EAAEC,QAAQ,CAACC,SAAT,CAAmBC,UAAnB,CAA8BC,UAA9B,CAA0C,GAAE,IAAIC,IAAJ,GAAWC,kBAAX,EAAgC,OAAM,IAAID,IAAJ,GAAWE,kBAAX,EAAgC,EAAlH;AADkD,OAAzD,EAEGC,IAFH,CAEQ,MAAM;AAAEC,QAAAA,MAAM,CAAC5B,QAAP,CAAgB6B,MAAhB,CAAuB,cAAvB;AAAuC,OAFvD;AAIA,KATD;AAUA;AACD,CA9BD;;AAgCA,OAAO,MAAMC,QAAQ,GAAG,MAAM;AAC7B,QAAMC,KAAK,GAAGlD,QAAQ,CAACmD,aAAT,CAAuB,QAAvB,CAAd;AACA,MAAIC,KAAJ;AACAF,EAAAA,KAAK,CAACG,gBAAN,CAAuB,MAAvB,EAA+B,MAAM;AACpC,UAAM5C,MAAM,GAAGnC,OAAO,CAACoC,qBAAR,CAA8BwC,KAA9B,CAAf;AACAlD,IAAAA,QAAQ,CAACI,IAAT,CAAcC,MAAd,CAAqBI,MAArB;AACA,UAAME,WAAW,GAAG;AAAEC,MAAAA,KAAK,EAAEsC,KAAK,CAACtC,KAAf;AAAsBC,MAAAA,MAAM,EAAEqC,KAAK,CAACrC;AAApC,KAApB;AACAvC,IAAAA,OAAO,CAACwC,eAAR,CAAwBL,MAAxB,EAAgCE,WAAhC;AACAyC,IAAAA,KAAK,GAAGE,WAAW,CAAC,YAAY;AAC/B,UAAI;AACH,cAAMhE,UAAU,GAAG,MAAMhB,OAAO,CAACiB,gBAAR,CAAyB2D,KAAzB,EAAgC,IAAI5E,OAAO,CAACiF,uBAAZ,EAAhC,EAAuE/D,iBAAvE,GAA2FgE,mBAA3F,EAAzB;AACA,cAAMnC,iBAAiB,GAAG/C,OAAO,CAACgD,aAAR,CAAsBhC,UAAtB,EAAkCqB,WAAlC,CAA1B;AACAF,QAAAA,MAAM,CAACgD,UAAP,CAAkB,IAAlB,EAAwBC,SAAxB,CAAkC,CAAlC,EAAqC,CAArC,EAAwCjD,MAAM,CAACG,KAA/C,EAAsDH,MAAM,CAACI,MAA7D;AACAvC,QAAAA,OAAO,CAACwD,IAAR,CAAa6B,cAAb,CAA4BlD,MAA5B,EAAoCY,iBAApC;AACA/C,QAAAA,OAAO,CAACwD,IAAR,CAAa8B,iBAAb,CAA+BnD,MAA/B,EAAuCY,iBAAvC;;AACA,YAAIA,iBAAiB,CAACN,SAAlB,CAA4B8C,KAA5B,CAAkCC,OAAlC,CAA0C,CAA1C,IAA+C,GAAnD,EAAwD;AACvD,gBAAMC,aAAa,CAACX,KAAD,CAAnB;AACA3C,UAAAA,MAAM,CAACgD,UAAP,CAAkB,IAAlB,EAAwBC,SAAxB,CAAkC,CAAlC,EAAqC,CAArC,EAAwCjD,MAAM,CAACG,KAA/C,EAAsDH,MAAM,CAACI,MAA7D;AACAb,UAAAA,QAAQ,CAACmD,aAAT,CAAuB,QAAvB,EAAiCjD,KAAjC,CAAuC8D,KAAvC,GAA+C,OAA/C;AACAhE,UAAAA,QAAQ,CAACmD,aAAT,CAAuB,QAAvB,EAAiCc,SAAjC,GAA6C,YAA7C;AACA/F,UAAAA,MAAM,CAACgG,IAAP,CAAY,UAAUC,QAAV,EAAoB;AAC/B5F,YAAAA,WAAW,GAAG4F,QAAd;AACA,WAFD;AAIA,gBAAMtE,OAAO,EAAb;AAEA,SAXD,MAWO;AACNG,UAAAA,QAAQ,CAACmD,aAAT,CAAuB,QAAvB,EAAiCjD,KAAjC,CAAuC8D,KAAvC,GAA8C,KAA9C;AACAhE,UAAAA,QAAQ,CAACmD,aAAT,CAAuB,QAAvB,EAAiCc,SAAjC,GAA6C,mCAA7C;AAEA;AACD,OAtBD,CAsBE,OAAMG,GAAN,EAAW;AACZ1F,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCyF,GAAzC;AACA;AACD,KA1BkB,EA0BhB,IA1BgB,CAAnB;AA2BA,GAhCD;AAiCA,CApCM","sourcesContent":["const Webcam = require('../helper/webcam')\nimport { ref } from 'vue';\nimport { globalState } from './useState';\nconst faceapi = require('../helper/faceApi.min.js')\n\nlet snappedFace = ref().value\n\n\nfunction loadLabeledImages() {\n\tconsole.log(globalState);\n\treturn Promise.all(\n\t\tlabels.map(async (label) => {\n\t\t\tconst descriptions = []\n\t\t\tfor (let i = 1; i <= 2; i++) {\n\t\t\t\tconsole.log(student[label])\n\t\t\t\tconst img = await faceapi.fetchImage(student[label])\n\t\t\t\tconst detections = await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor()\n\t\t\t\tdescriptions.push(detections.descriptor)\n\t\t\t}\n\n\t\t\treturn new faceapi.LabeledFaceDescriptors(label, descriptions)\n\t\t})\n\t)\n}\n\nconst scanImg = async()=> {\n    \n\tconst image = snappedFace\n\tconst container = document.createElement('div')\n\tcontainer.style.position = 'relative'\n\tdocument.body.append(container)\n\tconst labeledFaceDescriptors = await loadLabeledImages()\n\tconst faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors, 0.4)\n\n\tconst canvas = faceapi.createCanvasFromMedia(image)\n\tdocument.body.append(canvas)\n\tconst displaySize = { width: image.width, height: image.height }\n\tfaceapi.matchDimensions(canvas, displaySize)\n\tconst detection = await faceapi.detectAllFaces(image).withFaceLandmarks().withFaceDescriptors()\n\tif (detection.length < 1) {\n\t\tlocation.reload()\n\t} else { \n\t\tconst resizedDetections = faceapi.resizeResults(detection, displaySize)\n\t\tconst results = resizedDetections.map((d) => faceMatcher.findBestMatch(d.descriptor))\n\t\tresults.forEach((result, i) => {\n\t\t\tconst box = resizedDetections[i].detection.box\n\t\t\tconst drawBox = new faceapi.draw.DrawBox(box, { label: result.toString() })\n\t\t\tconsole.log(result._label)\n\t\t\tdrawBox.draw(canvas)\n\t\t\tdb.collection('students').doc(`${result._label}`).update({\n\t\t\t\tdate: firebase.firestore.FieldValue.arrayUnion(`${new Date().toLocaleTimeString()} of ${new Date().toLocaleDateString()}`)\n\t\t\t}).then(() => { window.location.assign('./index.html')});\n     \n\t\t})\n\t}\n}\n\nexport const SnapFace = () => {\n\tconst video = document.querySelector('#video')\n\tlet recog\n\tvideo.addEventListener('play', () => {\n\t\tconst canvas = faceapi.createCanvasFromMedia(video)\n\t\tdocument.body.append(canvas)\n\t\tconst displaySize = { width: video.width, height: video.height }\n\t\tfaceapi.matchDimensions(canvas, displaySize)\n\t\trecog = setInterval(async () => {\n\t\t\ttry {\n\t\t\t\tconst detections = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()\n\t\t\t\tconst resizedDetections = faceapi.resizeResults(detections, displaySize)\n\t\t\t\tcanvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n\t\t\t\tfaceapi.draw.drawDetections(canvas, resizedDetections)\n\t\t\t\tfaceapi.draw.drawFaceLandmarks(canvas, resizedDetections)\n\t\t\t\tif (resizedDetections.detection.score.toFixed(2) > 0.7) {\n\t\t\t\t\tawait clearInterval(recog)\n\t\t\t\t\tcanvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n\t\t\t\t\tdocument.querySelector('#alert').style.color = 'green';\n\t\t\t\t\tdocument.querySelector('#alert').innerHTML = 'Face found'\n\t\t\t\t\tWebcam.snap(function (data_uri) {\n\t\t\t\t\t\tsnappedFace = data_uri\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\tawait scanImg()\n                    \n\t\t\t\t} else {\n\t\t\t\t\tdocument.querySelector('#alert').style.color= 'red';\n\t\t\t\t\tdocument.querySelector('#alert').innerHTML = 'Can\\'t find a Face, Please Adjust'\n\t\t\t\n\t\t\t\t}\n\t\t\t} catch(err) {\n\t\t\t\tconsole.log('something went wrong ====', err )\n\t\t\t}\n\t\t}, 1000)\n\t});   \n}"]},"metadata":{},"sourceType":"module"}